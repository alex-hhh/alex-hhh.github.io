<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Who Owns the Fish?</title>
    <meta name="description" content="that is the question. To find the answer will use a logic programming DSL embedded in Racket, named _miniKanren_.  By the way, if you are in a hurry: the German owns the Fish. Twice....">
    <meta name="author"      content="Alex Harsányi">
    <meta name="keywords"    content="racket">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="canonical" href="https://alex-hhh.github.io/2021/08/fish-puzzle.html">
    <link rel="next" href="/2021/07/shaded-area-plot.html">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono&display=swap" rel="stylesheet">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110325732-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-110325732-1');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container">
        <a href="/index.html" class="navbar-brand">Alex Harsányi</a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbar_collapse" aria-controls="navbar_collapse"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu" role="menu" id="tags-menu-content">
                <!-- will be filled in dynamically by custom.js -->
              </ul>
            </li>
            <li>
              <a class="nav-link" href="/About.html">About</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/arduino.html">Arduino</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/racket.html">Racket</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/activitylog2.html">ActivityLog2</a>
            </li> 
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">

        <!-- Main column -->
        <!-- NOTE: there is a bug in the web server template renderer which
             indents all items inside if blocks.  This means that we cannot
             put the contents inside an if block, as all the <pre> tags will
             be indented.
          -->
        <div id="content" class=col-md-9>





          <article>
  <header>
    <h1>Who Owns the Fish?</h1>
    <p class='date-and-tags'>
<time datetime="2021-08-05" pubdate="true">2021-08-05</time> :: <span class="tags"><a href="/tags/racket.html">racket</a></span></p>
  </header>

<p>&hellip; that is the question. To find the answer will use a logic programming DSL embedded in Racket, named <em>miniKanren</em>.</p>

<p>By the way, if you are in a hurry: the German owns the Fish. Twice.</p>
<!-- more-->

<p>My copy of <a href="https://mitpress.mit.edu/books/reasoned-schemer-second-edition">The Reasoned Schemer, Second Edition</a> arrived earlier this week and, since I already went through the first edition some years ago, this time I opened it directly to Chapter 10 for the <em>miniKanren</em> implementation. The <em>miniKanren</em> language is very small, just a few hundred lines of Racket code, but the language itself is surprisningly powerfull. To test the implementation, it I decided to solve a logic puzzle, which seems to be well suited for logic programming languages.</p>

<div class="figure"><img src="/img/a049/trs.jpg" alt="" />
 <p class="caption"></p></div>

<h2 id="the-puzzle">The Puzzle</h2>

<p>There are many variants of this logic puzzle on the Internet, the <a href="https://en.wikipedia.org/wiki/Zebra_Puzzle">original</a> appeared in 1962 and was called the Zebra Puzzle. Since the clues in the original puzzle involve cigarette smoking, which is no longer fashionable, I found another variant which uses sport instead of cigarettes. The puzzle goes like this (<a href="https://www.mathsisfun.com/logicpuzzle.html">here is the source</a>):</p>

<blockquote>
 <p>There are five houses in a row and in five different colors. In each house lives a person from a different country. Each person drinks a certain drink, plays a certain sport, and keeps a certain pet. No two people drink the same drink, play the same sport, or keep the same pet.</p>
 <ul>
  <li>1 The Brit lives in a red house</li>
  <li>2 The Swede keeps dogs</li>
  <li>3 The Dane drinks tea</li>
  <li>4 The green house is on the left of the white house</li>
  <li>5 The green house owner drinks coffee</li>
  <li>6 The person who plays polo rears birds</li>
  <li>7 The owner of the yellow house plays hockey</li>
  <li>8 The man living in the house right in the center drinks milk</li>
  <li>9 The Norwegian lives in the first house</li>
  <li>10 The man who plays baseball lives next to the man who keeps cats</li>
  <li>11 The man who keeps horses lives next to the one who plays hockey</li>
  <li>12 The man who plays billiards drinks beer</li>
  <li>13 The German plays soccer</li>
  <li>14 The Norwegian lives next to the blue house</li></ul>
 <p>Who Owns the fish?</p></blockquote>

<p>Strictly speaking, it is not possible to answer the question and solve the puzzle: since the fish is not mentioned in any of the clues, we don&rsquo;t know that there even is a fish. However, another possible interpretation is that the question itself offers an additional clue: that someone owns a fish, and this makes the puzzle solvable, so we&rsquo;ll use the latter interpretation here.</p>

<p>Before we attempt to solve this puzzle, let&rsquo;s have a brief look at the <em>miniKanren</em> DSL.</p>

<h2 id="the-language">The Language</h2>

<p>The <em>miniKanren</em> implementation is quite small and the authors of "The Reasoned Schemer" explain its inner workings in one short chapter. There are many implementations you can use, available on the <em>miniKanren</em> <a href="http://minikanren.org/">website</a>, but the examples below are written using the language defined in the <strong>Second Edition</strong> of The Reasoned Schemer, which has <a href="https://groups.google.com/g/minikanren/c/fMKSBmOm_XM/m/V0K30F8lBwAJ">some differences</a> from the first edition.</p>

<hr />

<p>You can find the official second edition implementation <a href="https://github.com/TheReasonedSchemer2ndEd/CodeFromTheReasonedSchemer2ndEd/">here</a>, but for this blog post I wrote my own <em>miniKanren</em> implementation, which I used for solving the puzzle. Since this is my implementation, I took the liberty of renaming some operators, as I believe it makes them more readable, in particular, the book uses <code>conde</code>, here I use <code>cond/e</code>, the book uses <code>membero</code>, here I use <code>member/o</code>.</p>

<p>You can find my version of <em>miniKanren</em> in this <a href="https://gist.github.com/alex-hhh/e7bbe951872e627d8802c334a701980c">GitHub Gist</a>, to start using it, simply copy the racket file in a local folder and start the programs with the following lines:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="kn">#lang </span><span class="nn">racket</span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" style="color: inherit">require</a></span> <span class="s2">"mk.rkt"</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<hr />

<p><a href="http://minikanren.org/"><em>miniKanren</em></a> is an embedded Domain Specific Language (DSL) for logic programming. The language itself is quite small, with only 4 basic elements:</p>

<ul>
 <li>The unification operator, <code>==</code> which associates two terms, which can be  variables or values</li>
 <li>A mechanism to introduce new variables, called <code>fresh</code>, somewhat analogous  to <code>let</code> in Racket,</li>
 <li>Program control mechanism, called <code>cond/e</code>, somewhat analogous to <code>cond</code>  from Racket</li>
 <li>A mechanism to define new relations, <code>defrel</code>, which are analogous to  <code>define</code> in Racket.</li></ul>

<p>There are some other underlying elements in the language, such as <code>conj</code> for conjunction and <code>disj</code> for disjunction which are useful in user programs, plus there is an interface function which allow running <em>miniKanren</em> programs in Racket, named <code>run</code>.</p>

<h3 id="unification-using-">Unification using ==</h3>

<p><em>miniKanren</em> works by running queries which are embedded into Racket code. Here is a simple example:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">'</span><span class="ss">hello</span> <span class="n">q</span><span class="p">))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">hello</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>In the program above, we indicate that we want the value of the variable <code>q</code> and the program <code>(== 'hello q)</code> simply associates the value <code>'hello</code> with <code>q</code>. The result of the query is always a list, since the program can return multiple results. The <code>#f</code> argument to <code>run</code> is the number of answers we want to obtain, <code>#f</code> means that we want all the possible answers.</p>

<p>For example, the program below returns two values: <code>'hello</code> and <code>'world</code>, since <code>cond/e</code> specifies two alternatives:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="k">cond/e</span>
            <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">'</span><span class="ss">hello</span> <span class="n">q</span><span class="p">))</span>
            <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">'</span><span class="ss">world</span> <span class="n">q</span><span class="p">))))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">hello</span> <span class="ss">world</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>It is important to understand that <code>==</code> means association, not assignment. The order in which these associations are made is not important. In the program below, we create a new variable <code>x</code>, associate it with <code>q</code>, which has no value yet, than associate <code>x</code> with the value <code>'hello</code>. Since <code>q</code> and <code>x</code> are associated, <code>q</code> will also be associated with <code>'hello</code>:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">x</span> <span class="n">q</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">x</span> <span class="o">'</span><span class="ss">hello</span><span class="p">)))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">hello</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Another interesting feature of <code>==</code> is that it is able to &ldquo;look into&rdquo; lists. In the example below, the variable <code>q</code> is associated with a list of 3 elements, the symbol <code>'Result</code> and two variables <code>x</code> and <code>y</code>. Later, the two variables are associated with values:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Result</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="n">q</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">'</span><span class="ss">hello</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">'</span><span class="ss">world</span> <span class="n">y</span><span class="p">)))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Result</span> <span class="ss">hello</span> <span class="ss">world</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>You can also group sequence of logic steps into relations using <code>defrel</code>, these are analogous to functions in Racket. We will define such relations while solving the puzzle, but one important relation will be useful for our solution, and this is <code>member/o</code>, which we&rsquo;ll look at next.</p>

<h3 id="membero-relation">member/o relation</h3>

<p>The <code>member/o</code> relation is the <em>miniKanren</em> equivalent of the Racket <code>member?</code> function which checks that a value is present in a list, but there are some important differences:</p>

<ul>
 <li><code>(member? x l)</code> &mdash; returns true if <code>x</code> is present in the list <code>l</code></li>
 <li><code>(member/o x l)</code> &mdash; makes changes to both <code>x</code> and <code>l</code> such that <code>x</code> is  present in <code>l</code>, or fail if no such changes are possible.</li></ul>

<p>Below we&rsquo;ll look at some examples of the most important use cases.</p>

<p>In the simplest case, <code>member/o</code> can be used like <code>member?</code>, to check if a value is resent in a list:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="nb">member/o</span> <span class="mi">2</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">_.0</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The result of this query is a single <code>_.0</code> symbol since the goal succeeded but did not associate any answer with the question <code>q</code> &mdash; an alternative interpretation of this result is that the goal succeeds for any value of q.</p>

<p>A similar query but with a non-existent element, will return an empty list, since there are no valid values for <code>q</code> that would make the goal succeed.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="nb">member/o</span> <span class="mi">4</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
<span class="o">'</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>When the first variable passed to <code>member/o</code> has no associated value (i.e. it is fresh), the goal can be used to enumerate all elements in the list. The query below has three answers, one for each element in the input list. We associate the list <code>(Result ,r)</code> with the query <code>q</code>, so it is more obvious that the result of this query is not simply the input list <code>(1 2 3)</code>. The interpretation of this query result is that the query would succeed if <code>r</code> is ether 1, 2, or 3:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">`</span><span class="p">(</span><span class="ss">Result</span> <span class="o">,</span><span class="n">r</span><span class="p">)</span> <span class="n">q</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">member/o</span> <span class="n">r</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Result</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="ss">Result</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="ss">Result</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Finally, when the second variable passed to <code>member/o</code> is fresh, the relation can be used to generate all the lists which have 1 as a member. Since there is an infinite number of such lists, we specify the number of answers we want instead of specifying <code>#f</code> which would attempt to find all the answers, taking an infinite amount of time.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="mi">3</span> <span class="n">q</span> <span class="p">(</span><span class="nb">member/o</span> <span class="mi">1</span> <span class="n">q</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="mi">1</span> <span class="o">.</span> <span class="ss">_.0</span><span class="p">)</span> <span class="p">(</span><span class="ss">_.0</span> <span class="mi">1</span> <span class="o">.</span> <span class="ss">_.1</span><span class="p">)</span> <span class="p">(</span><span class="ss">_.0</span> <span class="ss">_.1</span> <span class="mi">1</span> <span class="o">.</span> <span class="ss">_.2</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Here the values <code>_.0</code>, <code>_.1</code>, etc, stand for &ldquo;any value&rdquo; and the result <code>(1 . _0)</code> represents all the lists which have 1 as the first element, since the result is a cons cell and <code>_0</code> can be replaced with an infinite number of lists.</p>

<p>There are more complex cases, when the <code>x</code> and <code>l</code> arguments are partially specified, but we will explore these as we solve the puzzle.</p>

<p><code>member/o</code> is not a <em>miniKanren</em> built-in, it can be implemented in just a few lines of code. For how and why this works, you will need to read the <em>miniKanren</em> book, but here is the entire implementation:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="nb">car/o</span> <span class="n">p</span> <span class="n">a</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span> <span class="n">a</span> <span class="n">d</span><span class="p">)</span> <span class="n">p</span><span class="p">)))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="nb">cdr/o</span> <span class="n">p</span> <span class="n">d</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span> <span class="n">a</span> <span class="n">d</span><span class="p">)</span> <span class="n">p</span><span class="p">)))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="nb">member/o</span> <span class="n">x</span> <span class="n">l</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond/e</span>
   <span class="p">((</span><span class="nb">car/o</span> <span class="n">l</span> <span class="n">x</span><span class="p">))</span>
   <span class="p">((</span><span class="k">fresh</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cdr/o</span> <span class="n">l</span> <span class="n">d</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">x</span> <span class="n">d</span><span class="p">)))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h2 id="the-solution">The Solution</h2>

<p>With the <em>miniKanren</em> introduction done, let&rsquo;s solve the puzzle. The idea behind the solution is that we will attempt to translate each clue into a relation and we will describe what properties the solution has, <strong>not</strong> how to build or search for the solution.</p>

<p>We will also add the clues one by one and we&rsquo;ll check what <em>miniKanren</em> can do with each clue. The first bit of information that we&rsquo;ll use is that &ldquo;there are five houses in a row&rdquo;. look.</p>

<h3 id="the-street">The Street</h3>

<p><em>miniKanren</em> only supports lists as data structures, so everything will be represented as a list, but, to differentiate between different types of things that we have to work with, the first element in our list will be a symbol denoting its type &mdash; this is not necessary for <em>miniKanren</em> but it makes the results easier to inspect. With this in mind, we will represent the solution, which is a street of five houses, as a list of 6 elements: the symbol <code>'Street</code> followed by 5 items. Here is how we can do this in <em>miniKanren</em>:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6
7</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">solution</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Here, we create five fresh variables (i.e. variables that have no values) and construct a list out of them, then associate this list with the puzzle result. Note how we define a separate relation, called <code>fish-puzzle</code> and run that. While this is not necessary at this stage, things will become easier to manage later on. Also note how the <code>fish-puzzle</code> relation mixes Racket code like <code>let</code> with <em>miniKanren</em> code like <code>fresh</code> and <code>==</code>, this works because <em>miniKanren</em> is an embedded DSL, so the Racket code is available inside <em>miniKanren</em> programs.</p>

<p>When trying to solve the puzzle, <em>miniKanren</em> comes up with the best possible solution, given the clues we provided so far: that we have a street with five unknown things in it, which are denoted by the symbols <code>_.0</code> through <code>_.4</code>.</p>

<h3 id="clues-about-houses">Clues About Houses</h3>

<p>We&rsquo;ll start with the simplest clues: these specify information about an individual house, and there are several of them.</p>

<blockquote>
 <ul>
  <li>1 The Brit lives in a red house</li>
  <li>2 The Swede keeps dogs</li>
  <li>3 The Dane drinks tea</li>
  <li>5 The green house owner drinks coffee</li>
  <li>6 The person who plays polo rears birds</li>
  <li>7 The owner of the yellow house plays hockey</li>
  <li>12 The man who plays billiards drinks beer</li>
  <li>13 The German plays soccer</li></ul></blockquote>

<p>Implementing relations for these clues requires us to represent houses, and just as with the street, we&rsquo;ll use a list, with the symbol <code>'House</code> as the first element followed by the nationality, house color, bet, beverage and sport. Here is the first clue:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">pet</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">Brit</span> <span class="o">'</span><span class="ss">Red</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The <code>brit-lives-in-red-house</code> relation constructs a house with the information we have, <code>'Brit</code> and <code>'Red</code> and fresh variables for the information we don&rsquo;t have. It than asserts that such a house must be a member of the street using <code>member/o</code>. We added the clue to the <code>fish-puzzle</code> and if we run the program, we now get 5 results:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">solution</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span><span class="p">)</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">)</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span><span class="p">)</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Since there are five houses in the street, and we only know the nationality and color of one of one house, there are now five possible solutions, by placing this house in every possible position.</p>

<p>The other clues in this section are represented using the same idea: construct a house with the information we have and asserting that it should be a member of the street.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">swede-keeps-dogs</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">Swede</span> <span class="n">color</span> <span class="o">'</span><span class="ss">Dogs</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">dane-drinks-tea</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color</span> <span class="n">pet</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">Dane</span> <span class="n">color</span> <span class="n">pet</span> <span class="o">'</span><span class="ss">Tea</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">green-house-owner-drinks-coffee</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality</span> <span class="n">pet</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="o">'</span><span class="ss">Green</span> <span class="n">pet</span> <span class="o">'</span><span class="ss">Coffee</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">polo-player-rears-birds</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality</span> <span class="n">color</span> <span class="n">beverage</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="n">color</span> <span class="o">'</span><span class="ss">Birds</span> <span class="n">beverage</span> <span class="o">'</span><span class="ss">Polo</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">yellow-house-owner-plays-hockey</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality</span> <span class="n">pet</span> <span class="n">beverage</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="o">'</span><span class="ss">Yellow</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="o">'</span><span class="ss">Hockey</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">billiad-player-drinks-beer</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span> <span class="o">'</span><span class="ss">Beer</span> <span class="o">'</span><span class="ss">Billiard</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">german-plays-soccer</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color</span> <span class="n">pet</span> <span class="n">beverage</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">German</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="o">'</span><span class="ss">Soccer</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Running this puzzle produces 2280 solutions containing all possible combinations given the clues we have so far. Note how the houses now have additional information that was not directly specified in the clues, For example, one possible solution is where the Dane lives in the Yellow house, even though this was not explicitly mentioned in any of the clues. Here are the first 3 possibilities:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>

  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">swede-keeps-dogs</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">dane-drinks-tea</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">green-house-owner-drinks-coffee</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">polo-player-rears-birds</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">yellow-house-owner-plays-hockey</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">billiad-player-drinks-beer</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">german-plays-soccer</span> <span class="n">solution</span><span class="p">))</span>

<span class="p">(</span><span class="nb">run</span> <span class="mi">3</span> <span class="n">solution</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Yellow</span> <span class="ss">_.0</span> <span class="ss">Tea</span> <span class="ss">Hockey</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">_.1</span> <span class="ss">Polo</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">Green</span> <span class="ss">Dogs</span> <span class="ss">Coffee</span> <span class="ss">_.2</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">Soccer</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">_.6</span> <span class="ss">_.7</span> <span class="ss">_.8</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">))</span>
  <span class="p">(</span><span class="ss">Street</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">Green</span> <span class="ss">_.1</span> <span class="ss">Coffee</span> <span class="ss">Soccer</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">_.2</span> <span class="ss">Yellow</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">Hockey</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">_.5</span> <span class="ss">Birds</span> <span class="ss">Tea</span> <span class="ss">Polo</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">_.6</span> <span class="ss">Dogs</span> <span class="ss">_.7</span> <span class="ss">_.8</span><span class="p">))</span>
  <span class="p">(</span><span class="ss">Street</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Yellow</span> <span class="ss">_.0</span> <span class="ss">Tea</span> <span class="ss">Hockey</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">Green</span> <span class="ss">Dogs</span> <span class="ss">Coffee</span> <span class="ss">_.1</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">_.2</span> <span class="ss">Polo</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">Soccer</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">_.6</span> <span class="ss">_.7</span> <span class="ss">_.8</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h3 id="clues-about-house-locations">Clues About House Locations</h3>

<p>Two of the clues add information about where a house is placed on the street:</p>

<blockquote>
 <ul>
  <li>8 The man living in the house right in the center drinks milk</li>
  <li>9 The Norwegian lives in the first house</li></ul></blockquote>

<p>Clue 8 can simply be expressed as the third house on the street has milk as the beverage:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">center-house-owner-drinks-milk</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span> <span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span> <span class="o">'</span><span class="ss">Milk</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="k">conj</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">house</span> <span class="n">h3</span><span class="p">)))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>In the relation above, we had to use <code>conj</code> to group the two goals inside the Racket <code>let</code> statement, <code>conj</code> means that both goals must hold. While it is possible to mix Racket and <em>miniKanren</em>, it is not always obvious how to do so without understanding the inner workings of <em>miniKanren</em>. If you are familiar with the backquote/unquotes in Racket, it is simpler to write the above relation shown below. This approach avoids the pitfalls of mixing Racket and <em>miniKanren</em> code:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">center-house-owner-drinks-milk/alternate</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span> <span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">`</span><span class="p">(</span><span class="ss">Street</span> <span class="o">,</span><span class="n">h1</span> <span class="o">,</span><span class="n">h2</span> <span class="o">,</span><span class="n">h3</span> <span class="o">,</span><span class="n">h4</span> <span class="o">,</span><span class="n">h5</span><span class="p">)</span> <span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="o">`</span><span class="p">(</span><span class="ss">House</span> <span class="o">,</span><span class="n">nationality</span> <span class="o">,</span><span class="n">color</span> <span class="o">,</span><span class="n">pet</span> <span class="ss">Milk</span> <span class="o">,</span><span class="n">sport</span><span class="p">)</span> <span class="n">h3</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The clue that &ldquo;the Norvegian lives in the first house&rdquo; can be expressed the same way. There is some ambiguity in this statement, since &ldquo;first house&rdquo; can mean either &ldquo;first from the left&rdquo; or &ldquo;first from the right&rdquo;. We could just use one assumption, but we can also represent this ambiguity as different possibilities, expressed as the <code>disj</code> statement, which means that either of the goals must hold.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6
7
8
9</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">norvegian-in-first-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">Norvegian</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="k">conj</span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)</span>
       <span class="p">(</span><span class="k">disj</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">house</span> <span class="n">h1</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">house</span> <span class="n">h5</span><span class="p">))))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>To check that the previous relation works as expected, here is what the solutions look if we leave just this relation in the puzzle: there are two possibilities, one that the Norvegian is in the first house from the left and the second one that the Norvegian is in the first house from the right:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6
7
8
9</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>
    <span class="p">(</span><span class="n">norvegian-in-first-house</span> <span class="n">solution</span><span class="p">))</span>

<span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">solution</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span> <span class="ss">_.7</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span> <span class="ss">_.7</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Adding these two clues to the puzzle reduces the number of possibilities to 336 solutions, since there are now less possibilities to satisfy all of the clues given so far.</p>

<h3 id="to-the-left-of-relationships">&ldquo;To-The-Left-Of&rdquo; Relationships</h3>

<blockquote>
 <ul>
  <li>4 The green house is on the left of the white house</li></ul></blockquote>

<p>The fourth clue, that &ldquo;the green house is on the left of the white house&rdquo; represents a constraint between two houses. The &ldquo;to the left of&rdquo; part of the clue can be represented as a separate relation, and, since there are only 5 houses in the street, it is simpler to just handle every possibility directly:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6
7
8
9</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">to-the-left-of/o</span> <span class="n">house-a</span> <span class="n">house-b</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">))</span>
    <span class="p">(</span><span class="k">cond/e</span>
     <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h1</span> <span class="n">house-a</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h2</span> <span class="n">house-b</span><span class="p">))</span>
     <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h2</span> <span class="n">house-a</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h3</span> <span class="n">house-b</span><span class="p">))</span>
     <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h3</span> <span class="n">house-a</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h4</span> <span class="n">house-b</span><span class="p">))</span>
     <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h4</span> <span class="n">house-a</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">h5</span> <span class="n">house-b</span><span class="p">)))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>It is important to understand that <code>to-the-left-of/o</code> will <em>generate</em> the possible solutions given what is known about <code>house-a</code>, <code>house-b</code> and <code>puzzle</code>, plus the additional restrictions specified by the relation itself (that <code>house-a</code> is to the left of <code>house-b</code>).</p>

<p>Here is how we can write our clue using the <code>to-the-left-of/o</code> relation:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">green-house-left-of-white-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">sport1</span> <span class="n">nationality2</span> <span class="n">pet1</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">green-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality1</span> <span class="o">'</span><span class="ss">Green</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">sport1</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">white-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality2</span> <span class="o">'</span><span class="ss">White</span> <span class="n">pet2</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)])</span>
    <span class="p">(</span><span class="n">to-the-left-of/o</span> <span class="n">green-house</span> <span class="n">white-house</span> <span class="n">solution</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Updating the puzzle with the new relation produces 240 results, further constraining the number of possibilities.</p>

<h3 id="next-to-relationships">&ldquo;Next-To&rdquo; relationships</h3>

<p>The remaining clues have a &ldquo;next to&rdquo; relationship between the houses:</p>

<blockquote>
 <ul>
  <li>10 The man who plays baseball lives next to the man who keeps cats</li>
  <li>11 The man who keeps horses lives next to the one who plays hockey</li>
  <li>14 The Norwegian lives next to the blue house</li></ul></blockquote>

<p>The &ldquo;next to&rdquo; relationship can be expressed in terms of the <code>to-the-left-of/o</code> relationship: <code>x</code> is next to <code>y</code> if either <code>x</code> is to the left of <code>y</code> or <code>y</code> is to the left of <code>x</code>:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">next-to/o</span> <span class="n">x</span> <span class="n">y</span> <span class="n">l</span><span class="p">)</span>
  <span class="p">(</span><span class="k">disj</span>
   <span class="p">(</span><span class="n">to-the-left-of/o</span> <span class="n">x</span> <span class="n">y</span> <span class="n">l</span><span class="p">)</span>
   <span class="p">(</span><span class="n">to-the-left-of/o</span> <span class="n">y</span> <span class="n">x</span> <span class="n">l</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Using this relationship we can write the final clues in <em>miniKanren</em>:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">baseball-player-lives-next-to-cat-owner</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality1</span> <span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">nationality2</span> <span class="n">color2</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">baseball-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality1</span> <span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="o">'</span><span class="ss">Baseball</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">cat-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality2</span> <span class="n">color2</span> <span class="o">'</span><span class="ss">Cats</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)])</span>
    <span class="p">(</span><span class="n">next-to/o</span> <span class="n">baseball-house</span> <span class="n">cat-house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">hockey-player-lives-next-to-horse-owner</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">nationality1</span> <span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">nationality2</span> <span class="n">color2</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">hockey-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality1</span> <span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="o">'</span><span class="ss">Hockey</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">horse-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality2</span> <span class="n">color2</span> <span class="o">'</span><span class="ss">Horses</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)])</span>
    <span class="p">(</span><span class="n">next-to/o</span> <span class="n">hockey-house</span> <span class="n">horse-house</span> <span class="n">solution</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">norvegian-lives-next-to-blue-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">sport1</span> <span class="n">nationality2</span> <span class="n">pet2</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">norvegian-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="o">'</span><span class="ss">Norvegian</span> <span class="n">color1</span> <span class="n">pet1</span> <span class="n">beverage1</span> <span class="n">sport1</span><span class="p">)]</span>
          <span class="p">[</span><span class="n">blue-house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality2</span> <span class="o">'</span><span class="ss">Blue</span> <span class="n">pet2</span> <span class="n">beverage2</span> <span class="n">sport2</span><span class="p">)])</span>
    <span class="p">(</span><span class="n">next-to/o</span> <span class="n">norvegian-house</span> <span class="n">blue-house</span> <span class="n">solution</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h3 id="so-who-owns-the-fish">So, Who Owns the Fish?</h3>

<p>Here is the puzzle with all the clues added:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>

  <span class="c1">;; Clues about the houses</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">swede-keeps-dogs</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">dane-drinks-tea</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">green-house-owner-drinks-coffee</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">polo-player-rears-birds</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">yellow-house-owner-plays-hockey</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">billiad-player-drinks-beer</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">german-plays-soccer</span> <span class="n">solution</span><span class="p">)</span>

  <span class="c1">;; Clues about house positions on the street</span>
  <span class="p">(</span><span class="n">center-house-owner-drinks-milk</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">norvegian-in-first-house</span> <span class="n">solution</span><span class="p">)</span>

  <span class="c1">;; To-the-left-of clues</span>
  <span class="p">(</span><span class="n">green-house-left-of-white-house</span> <span class="n">solution</span><span class="p">)</span>

  <span class="c1">;; Next-to clues</span>
  <span class="p">(</span><span class="n">baseball-player-lives-next-to-cat-owner</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">hockey-player-lives-next-to-horse-owner</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">norvegian-lives-next-to-blue-house</span> <span class="n">solution</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Running this program produces two solutions &mdash; the two solutions correspond to the ambiguity about what &ldquo;first house&rdquo; means in clue 9: The Norwegian lives in the first house. The puzzle would have only one solution if we assume that the Norwegian lives in the first house on the left.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">solution</span> <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">Green</span> <span class="ss">_.0</span> <span class="ss">Coffee</span> <span class="ss">Soccer</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">White</span> <span class="ss">Dogs</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">Milk</span> <span class="ss">Polo</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Blue</span> <span class="ss">Horses</span> <span class="ss">Tea</span> <span class="ss">Baseball</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">Yellow</span> <span class="ss">Cats</span> <span class="ss">_.1</span> <span class="ss">Hockey</span><span class="p">))</span>
  <span class="p">(</span><span class="ss">Street</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">Yellow</span> <span class="ss">Cats</span> <span class="ss">_.0</span> <span class="ss">Hockey</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Blue</span> <span class="ss">Horses</span> <span class="ss">Tea</span> <span class="ss">Baseball</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">Milk</span> <span class="ss">Polo</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">Green</span> <span class="ss">_.1</span> <span class="ss">Coffee</span> <span class="ss">Soccer</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">White</span> <span class="ss">Dogs</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Neither solution has anything to say about a fish, since the fish does not appear anywhere in the clues. However both solutions contain some placeholder symbols, <code>_.0</code> and <code>_.1</code>, indicating that we don&rsquo;t know what pet the German has or what beverage the Norvegian drinks. The <code>_.0</code> and <code>_.1</code> have no special meaning except to say that they need to be different from each other. Also, placeholder symbols are specific to one answer only: the <code>_.0</code> from the first solution is not related to the <code>_.0</code> from the second solution.</p>

<p>We can how ask the question &ldquo;who owns the fish?&rdquo; using the relation below. Note that this relation takes two arguments both the street and a nationality, which can be used as an output argument to determine the owner.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">who-owns-the-fish?</span> <span class="n">solution</span> <span class="n">nationality</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="n">color</span> <span class="o">'</span><span class="ss">Fish</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Running the query produces two answers, since there are two solutions, but both answers are the same: the German owns the fish, since the solution does not change even with the ambiguity of clue 9.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">fish-owner</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">solution</span><span class="p">)</span>
     <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
     <span class="p">(</span><span class="n">who-owns-the-fish?</span> <span class="n">solution</span> <span class="n">fish-owner</span><span class="p">)))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">German</span> <span class="ss">German</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The <code>who-owns-the-fish?</code> relation not only extracts the owner of the fish, but also updates the puzzle to assign a fish to someone, adding the new knowledge that there is a fish to the solution. This is easy to see if we extract both the fish owner and the final puzzle solution, the German now has an assigned pet.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="p">(</span><span class="n">fish-owner</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">who-owns-the-fish?</span> <span class="n">solution</span> <span class="n">fish-owner</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">German</span>
   <span class="p">(</span><span class="ss">Street</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">Green</span> <span class="ss">Fish</span> <span class="ss">Coffee</span> <span class="ss">Soccer</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">White</span> <span class="ss">Dogs</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">Milk</span> <span class="ss">Polo</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Blue</span> <span class="ss">Horses</span> <span class="ss">Tea</span> <span class="ss">Baseball</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">Yellow</span> <span class="ss">Cats</span> <span class="ss">_.0</span> <span class="ss">Hockey</span><span class="p">)))</span>
  <span class="p">(</span><span class="ss">German</span>
   <span class="p">(</span><span class="ss">Street</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Norvegian</span> <span class="ss">Yellow</span> <span class="ss">Cats</span> <span class="ss">_.0</span> <span class="ss">Hockey</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Dane</span> <span class="ss">Blue</span> <span class="ss">Horses</span> <span class="ss">Tea</span> <span class="ss">Baseball</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">Birds</span> <span class="ss">Milk</span> <span class="ss">Polo</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">German</span> <span class="ss">Green</span> <span class="ss">Fish</span> <span class="ss">Coffee</span> <span class="ss">Soccer</span><span class="p">)</span>
    <span class="p">(</span><span class="ss">House</span> <span class="ss">Swede</span> <span class="ss">White</span> <span class="ss">Dogs</span> <span class="ss">Beer</span> <span class="ss">Billiard</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The <code>who-owns-the-fish?</code> can also be used to ask if a specific nationality owns the fish. For example, asking if the Norvegian owns the fish produces zero results, since the Norvegian does not own the fish:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">who-owns-the-fish?</span> <span class="n">solution</span> <span class="o">'</span><span class="ss">Norvegian</span><span class="p">)))</span>
<span class="o">'</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h3 id="does-the-german-really-own-the-fish">Does the German Really Own the Fish?</h3>

<p>The Fish does not appear in any of the clues this puzzle, so, technically, we don&rsquo;t know who owns the Fish. The <code>who-owns-the-fish?</code> relation shown above will add the Fish to the solution, if the goal would succeed while doing that, so this relation not only queries the solution, but also influences it.</p>

<p>To find out if there really is a fish, one option is to just get the solution out of <em>miniKanren</em> and use Racket code to search for the fish, which will be nowhere to be found. However, the the code we have written so far only involves describing the solution and leaving <em>miniKanren</em> to do the searching, so we&rsquo;ll try to write another relation that can look for the fish without adding it if it is not already present.</p>

<p>The <code>who-really-owns-this-pet?</code> relation works by looking at every house in the street, using <code>project</code> to bind the value of the pet so Racket code can inspect it. The Racket code will check if the pet is the one we are looking for, and use the <em>miniKanren</em> <code>succeed</code> or <code>fail</code> goals depending on the test result:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6
7
8
9</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">who-really-owns-this-pet?</span> <span class="n">solution</span> <span class="n">nationality</span> <span class="n">this-pet</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">color</span> <span class="n">beverage</span> <span class="n">pet</span> <span class="n">sport</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">house</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">House</span> <span class="n">nationality</span> <span class="n">color</span> <span class="n">pet</span> <span class="n">beverage</span> <span class="n">sport</span><span class="p">)])</span>
      <span class="p">(</span><span class="k">conj</span>
       <span class="p">(</span><span class="nb">member/o</span> <span class="n">house</span> <span class="n">solution</span><span class="p">)</span>
       <span class="p">(</span><span class="k">project</span> <span class="p">(</span><span class="n">pet</span><span class="p">)</span>
         <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Equality.html#(def._((quote._~23~25kernel)._equal~3f))" style="color: inherit">equal?</a></span> <span class="n">pet</span> <span class="n">this-pet</span><span class="p">)</span>
             <span class="nb">succeed</span>
             <span class="nb">fail</span><span class="p">))))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Using the new relation to query the result produces an empty list, meaning the puzzle has no solution:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">who-really-owns-this-pet?</span> <span class="n">solution</span> <span class="n">q</span> <span class="o">'</span><span class="ss">Fish</span><span class="p">)))</span>
<span class="o">'</span><span class="p">()</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>You may have noticed that, unlike the <code>who-owns-the-fish?</code> relation, the <code>who-really-owns-this-pet?</code> has a third argument for the pet we are looking for. This is useful to verify that the relation is working, since it is very easy to write an incorrect <em>miniKanren</em> program which fails, ant it is difficult to distinguish failure because of a program bug from failure to find a result. In this case, we can verify our relation by asking who owns a pet which exists in the solution:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">fish-puzzle</span> <span class="n">solution</span><span class="p">)</span>
    <span class="p">(</span><span class="n">who-really-owns-this-pet?</span> <span class="n">solution</span> <span class="n">q</span> <span class="o">'</span><span class="ss">Cats</span><span class="p">)))</span>
<span class="o">'</span><span class="p">(</span><span class="ss">Norvegian</span> <span class="ss">Norvegian</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h2 id="the-caveat">The Caveat</h2>

<p>Relations in a logic program are interchangeable, that is, we can change the order of the relations in the fish puzzle and still obtain the same result. Unfortunately, there are some caveats in doing this, which show up when the <em>miniKanren</em> implementation &ldquo;leaks out&rdquo;. To illustrate the problem, we&rsquo;ll use the simpler version of the puzzle with the only two relations being &ldquo;there are 5 houses on the street&rdquo; and &ldquo;the Brit owns the Red house&rdquo;:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle1</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>Running this puzzle produces five solutions, since there are five houses on the street.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="n">fish-puzzle1</span> <span class="n">q</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span><span class="p">)</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">)</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span><span class="p">)</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>What happens if we change the order of the relations, asserting that the "Brit owns the Red house" than that there are 5 houses on the street:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle2</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>This produces the same 5 solutions, but note that we had to ask only for 5 solutions, using <code>(run 5 ...)</code>, if we as for 6 or more solutions, or for all the solutions using <code>(run #f ...)</code>, the program will run forever.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5
6</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="nb">run</span> <span class="mi">5</span> <span class="n">q</span> <span class="p">(</span><span class="n">fish-puzzle2</span> <span class="n">q</span><span class="p">))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span><span class="p">)</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">)</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span><span class="p">)</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>To understand what is happening, lets add some tracing to the relations. You can see that the first goal produces a street if 5 houses and the next goal starts filling in the solution. Since the first gaol is limited to one solution, the <code>member/o</code> relation is also limited to placing the house inside a street with a limited number of houses:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle1</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>
  <span class="p">(</span><span class="n">show</span> <span class="s2">"after 5 houses"</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">show</span> <span class="s2">"after brit-lives-in-red-house"</span> <span class="n">solution</span><span class="p">))</span>

<span class="p">(</span><span class="nb">run</span> <span class="no">#f</span> <span class="n">q</span> <span class="p">(</span><span class="n">fish-puzzle1</span> <span class="n">q</span><span class="p">))</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 _.2 _.3 _.4)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (Street (House Brit Red _.0 _.1 _.2) _.3 _.4 _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 (House Brit Red _.1 _.2 _.3) _.4 _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 (House Brit Red _.2 _.3 _.4) _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 _.2 (House Brit Red _.3 _.4 _.5) _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 _.2 _.3 (House Brit Red _.4 _.5 _.6))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span><span class="p">)</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">)</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span><span class="p">)</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>In the second version of the puzzle, the <code>brit-lives-in-red-house</code> starts producing an infinite number of lists which would satisfy the relation, and the following goal rejects the first one (since the solution has to start with the symbol <code>'Street</code>), than matches the flowing 5 solutions to a street of 5 houses. However, if we were to ask for a 6th solution, <code>brit-lives-in-red-house</code> will happily produce a candidate, but the next goal will fail since it cannot fit a 5 house street if there are already 6 houses or more, so it will reject this candidate, causing <code>brit-lives-in-red-house</code> to produce the next candidate which is an even longer list, which will be rejected again, causing an infinite loop. You can try that out yourself by running the program with the added tracing and asking for 6 solutions:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k">defrel</span> <span class="p">(</span><span class="n">fish-puzzle2</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">brit-lives-in-red-house</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="n">show</span> <span class="s2">"after brit-lives-in-red-house"</span> <span class="n">solution</span><span class="p">)</span>
  <span class="p">(</span><span class="k">fresh</span> <span class="p">(</span><span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span> <span class="p">([</span><span class="n">street</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span> <span class="o">'</span><span class="ss">Street</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span> <span class="n">h4</span> <span class="n">h5</span><span class="p">)])</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._~3d~3d))" style="color: inherit">==</a></span> <span class="n">street</span> <span class="n">solution</span><span class="p">)))</span>
  <span class="p">(</span><span class="n">show</span> <span class="s2">"after 5 houses"</span> <span class="n">solution</span><span class="p">))</span>

<span class="p">(</span><span class="nb">run</span> <span class="mi">5</span> <span class="n">q</span> <span class="p">(</span><span class="n">fish-puzzle2</span> <span class="n">q</span><span class="p">))</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; ((House Brit Red _.0 _.1 _.2) . _.3)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (_.0 (House Brit Red _.1 _.2 _.3) . _.4)</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street (House Brit Red _.0 _.1 _.2) _.3 _.4 _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (_.0 _.1 (House Brit Red _.2 _.3 _.4) . _.5)</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 (House Brit Red _.1 _.2 _.3) _.4 _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (_.0 _.1 _.2 (House Brit Red _.3 _.4 _.5) . _.6)</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 (House Brit Red _.2 _.3 _.4) _.5 _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (_.0 _.1 _.2 _.3 (House Brit Red _.4 _.5 _.6) . _.7)</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 _.2 (House Brit Red _.3 _.4 _.5) _.6)</span>
<span class="c1">;; *** after brit-lives-in-red-house</span>
<span class="c1">;;     puzzle -&gt; (_.0 _.1 _.2 _.3 _.4 (House Brit Red _.5 _.6 _.7) . _.8)</span>
<span class="c1">;; *** after 5 houses</span>
<span class="c1">;;     puzzle -&gt; (Street _.0 _.1 _.2 _.3 (House Brit Red _.4 _.5 _.6))</span>
<span class="o">'</span><span class="p">((</span><span class="ss">Street</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span><span class="p">)</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span><span class="p">)</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="ss">_.4</span><span class="p">)</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.3</span> <span class="ss">_.4</span> <span class="ss">_.5</span><span class="p">)</span> <span class="ss">_.6</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">Street</span> <span class="ss">_.0</span> <span class="ss">_.1</span> <span class="ss">_.2</span> <span class="ss">_.3</span> <span class="p">(</span><span class="ss">House</span> <span class="ss">Brit</span> <span class="ss">Red</span> <span class="ss">_.4</span> <span class="ss">_.5</span> <span class="ss">_.6</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>The miniKanren web site at <a href="http://minikanren.org">miniKanren.org</a> has a lot of resources on logic programming, including published papers on various extentions plus videos of talks. Some of the papers provide really interesting extensions to the miniKanren languages and are worth exploring &mdash; but not in this blog post&hellip;</p>
  <footer>
    <div class="fine-print">© Alex Harsányi, licensed under
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      , and there's a <a href="/Cookies.html">cookie policy</a>.
    </div>
    <div class="row justify-content-center">
      <nav aria-label="Page Navigation">
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="/2021/07/shaded-area-plot.html"
               aria-label="Previous">
              <span aria-hidden="true">&larr; Shaded Area Plot</span>
            </a>
          </li>

        </ul>
      </nav>
    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.identifier = undefined;
        this.page.url = undefined;
        this.page.title = undefined;
        this.page.category_id = undefined;
      };
      var disqus_shortname = 'alex-hhh-github-com';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          dsq.setAttribute('data-timestamp', +new Date());
          (document.head || document.body).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>
</article>
        </div>
        <div id="sidebar-content" class="col-md-3">
          <!-- will be filled in dynamically by custom.js -->
        </div>

      </div>

    </div>
    <!-- </body> JS -->
  <!-- NOTE: jQuery must be loaded first -->
  <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="/js/custom.js"></script>
  </body>
</html>