<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Asteroids (Gameplay)</title>
    <meta name="description" content="having spent most of the first blog post on writing a small game engine to be able to handle the Asteroids game, in this post we'll look at how to implement the actors to actually make the game playable....">
    <meta name="author"      content="Alex Harsányi">
    <meta name="keywords"    content="racket, games in racket">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="canonical" href="https://alex-hhh.github.io/2021/10/asteroids-part-2.html">
    <link rel="next" href="/2021/10/asteroids-part-1.html">
    <link rel="prev" href="/2022/05/heat-maps-revisited.html">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono&display=swap" rel="stylesheet">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110325732-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-110325732-1');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container">
        <a href="/index.html" class="navbar-brand">Alex Harsányi</a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbar_collapse" aria-controls="navbar_collapse"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu" role="menu" id="tags-menu-content">
                <!-- will be filled in dynamically by custom.js -->
              </ul>
            </li>
            <li>
              <a class="nav-link" href="/About.html">About</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/arduino.html">Arduino</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/racket.html">Racket</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/activitylog2.html">ActivityLog2</a>
            </li> 
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">

        <!-- Main column -->
        <!-- NOTE: there is a bug in the web server template renderer which
             indents all items inside if blocks.  This means that we cannot
             put the contents inside an if block, as all the <pre> tags will
             be indented.
          -->
        <div id="content" class=col-md-9>





          <article>
  <header>
    <h1>Asteroids (Gameplay)</h1>
    <p class='date-and-tags'>
<time datetime="2021-10-16" pubdate="true">2021-10-16</time> :: <span class="tags"><a href="/tags/racket.html">racket</a>, <a href="/tags/games-in-racket.html">games in racket</a></span></p>
  </header>

<p>&hellip; having spent most of the <a href="/2021/10/asteroids-part-1.html">first blog post</a> on writing a small game engine to be able to handle the Asteroids game, in this post we&rsquo;ll look at how to implement the actors to actually make the game playable.</p>
<!-- more-->

<p>This is the second part of a two-part series on implementing an Asteroids game, and, if you haven&rsquo;t already, you might want to read the <a href="/2021/10/asteroids-part-1.html">first part</a>, since it covers the basics of how the game is built, and things in this blog post will not make much sense without it. Also, if you are in a hurry, you can find the full implementation in this <a href="https://gist.github.com/alex-hhh/93f4e3ae35e0050ded74e9341dbc2824">GitHub gist</a></p>

<p>In the first blog post we already implemented the asteroids and have them interact with each other and we&rsquo;ll continue by looking at another important actor in the game: the space ship.</p>

<h2 id="the-space-ship">The Space Ship</h2>

<p>Just as we did with asteroids, the model of the space ship is drawn on paper and is made to fit inside a unit circle (a circle of radius 1). The space ship will have two parts: an outline of the ship itself and a small triangle at one end, representing the ship&rsquo;s thrust &mdash; this will be shown when the ship is under acceleration:</p>

<div class="figure"><img src="/img/a052/space-ship-model.png" alt="" />
 <p class="caption"></p></div>

<p>Here are the definitions for the space ship models. Since the space ship will be of constant size, the scale can also be defined as a global variable:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship-points</span><span class="w"></span>
<span class="w">  </span><span class="o">'</span><span class="p">((</span><span class="m">5/5</span><span class="w"> </span><span class="m">0/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-4/5</span><span class="w"> </span><span class="m">-3/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-3/5</span><span class="w"> </span><span class="m">-1/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-3/5</span><span class="w"> </span><span class="m">1/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-4/5</span><span class="w"> </span><span class="m">3/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">5/5</span><span class="w"> </span><span class="m">0/5</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship-path</span><span class="w"> </span><span class="p">(</span><span class="n">points-&gt;dc-path</span><span class="w"> </span><span class="n">space-ship-points</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship-thrust-path</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">points-&gt;dc-path</span><span class="w"> </span><span class="o">'</span><span class="p">((</span><span class="m">-3/5</span><span class="w"> </span><span class="m">-1/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-4/5</span><span class="w"> </span><span class="m">0/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-3/5</span><span class="w"> </span><span class="m">1/5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="m">-3/5</span><span class="w"> </span><span class="m">-1/5</span><span class="p">))))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship-scale</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Just as with the asteroids, we can create the space ship with a physics body and have <code>update/delta-time</code> and <code>paint</code> methods, but unlike asteroids, the ship will start with no initial velocity or acceleration, that is, it will not move:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init-field))" style="color: inherit">init-field</a></span><span class="w"> </span><span class="p">[</span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="n">canvas-width</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="n">canvas-height</span><span class="w"> </span><span class="mi">2</span><span class="p">))])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">body</span><span class="w"></span>
<span class="w">       </span><span class="n">position</span><span class="w"></span>
<span class="w">       </span><span class="n">vzero</span><span class="w">                </span><span class="c1">; no initial velocity</span><span class="w"></span>
<span class="w">       </span><span class="n">vzero</span><span class="w">                </span><span class="c1">; no initial acceleration</span><span class="w"></span>
<span class="w">       </span><span class="n">space-ship-scale</span><span class="w"></span>
<span class="w">       </span><span class="mi">0</span><span class="w">                    </span><span class="c1">; orientation</span><span class="w"></span>
<span class="w">       </span><span class="mi">0</span><span class="w">                    </span><span class="c1">; no angular-velocity</span><span class="w"></span>
<span class="w">       </span><span class="mf">0.98</span><span class="p">))</span><span class="w">               </span><span class="c1">; velocity damping</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="n">update-body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="n">dt</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="p">(</span><span class="n">make-scaled-pen</span><span class="w"> </span><span class="s2">"forestgreen"</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">space-ship-scale</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">thrust-pen</span><span class="w"> </span><span class="p">(</span><span class="n">make-scaled-pen</span><span class="w"> </span><span class="s2">"dark orange"</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">space-ship-scale</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">paint</span><span class="w"> </span><span class="n">_canvas</span><span class="w"> </span><span class="n">dc</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">draw-model</span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">space-ship-path</span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="n">the-body</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="c1">;; If the ship is accelerating or has an angular velocity, also draw the</span><span class="w"></span>
<span class="w">      </span><span class="c1">;; thrust outline.</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" style="color: inherit">or</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" style="color: inherit">not</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" style="color: inherit">zero?</a></span><span class="w"> </span><span class="p">(</span><span class="n">body-angular-velocity</span><span class="w"> </span><span class="n">the-body</span><span class="p">)))</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">vlength</span><span class="w"> </span><span class="p">(</span><span class="n">body-acceleration</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">draw-model</span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">space-ship-thrust-path</span><span class="w"> </span><span class="n">thrust-pen</span><span class="w"> </span><span class="n">the-body</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>To make the ship move, we will need to handle user input and update the ship&rsquo;s acceleration and angular velocity. This is done by implementing the <code>keyboard-event</code> method of the <code>actor&lt;%&gt;</code> interface, and there are two key things about the implementation:</p>

<ul>
 <li>the keyboard events modify the acceleration and angular velocity of the  physics body representing the ship, they don&rsquo;t move the ship itself, which  is done by the <code>update-body</code> function of the physics engine which will  calculate a new position based on the speed and velocity of the body.</li>
 <li>the function monitors key presses and key releases separately, and, when a  key is released, it sets the acceleration or angular velocity to zero. The  ship will continue to maintain its speed and direction and will slow down  because the velocity damping value is lower than 1. All this is  automatically handled by the <code>update-body</code> function of the physics engine.</li></ul>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; Rest of the space-ship% class is unchanged</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">keyboard-event</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">get-key-code</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">left</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mf">-0.005</span><span class="p">])))</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">right</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mf">0.005</span><span class="p">])))</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">up</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="p">(</span><span class="n">vrotate</span><span class="w"> </span><span class="n">vright</span><span class="w"> </span><span class="p">(</span><span class="n">body-orientation</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"> </span><span class="mf">0.001</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">acceleration</span><span class="w"> </span><span class="n">a</span><span class="p">])))</span><span class="w"></span>

<span class="w">        </span><span class="p">((</span><span class="n">release</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">get-key-release-code</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" style="color: inherit">member</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="ss">left</span><span class="w"> </span><span class="ss">right</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mi">0</span><span class="p">])))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" style="color: inherit">member</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="ss">up</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">acceleration</span><span class="w"> </span><span class="n">vzero</span><span class="p">]))))))</span><span class="w"></span>

<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can use the space ship object as it is now, however, unless the user is very skilled, the ship can easily fly off the screen so it is no longer visible. To keep the ship inside the window (that is, the playing field), we can add collisions with the walls, same as we did to keep the asteroids inside the playing field in the <a href="/2021/10/asteroids-part-1.html">previous blog post</a>. Since the ship also has a physics body, we can reuse the <code>body-wall-collision?</code> function to check for the actual collision and tell the space ship that it bumped into a wall:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">handle-space-ship-wall-collision</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="n">body-wall-collision?</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">get-normal</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">get-distance</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">bumped-into-wall</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">get-normal</span><span class="p">))))</span><span class="w"></span>

<span class="p">(</span><span class="n">add-collision-handler</span><span class="w"> </span><span class="n">space-ship%</span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="n">handle-space-ship-wall-collision</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The <code>space-ship%</code> class itself will need to be extended with a <code>get-body</code> and <code>bumped-into-wall</code> methods, which are pretty simple: we handle bumping into the wall using the same <code>bounce-body</code> function from the physics engine, as we did for the asteroids:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; Rest of the space-ship% class is unchanged</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/public))" style="color: inherit">define/public</a></span><span class="w"> </span><span class="p">(</span><span class="n">get-body</span><span class="p">)</span><span class="w"> </span><span class="n">the-body</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/public))" style="color: inherit">define/public</a></span><span class="w"> </span><span class="p">(</span><span class="n">bumped-into-wall</span><span class="w"> </span><span class="n">normal</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="n">bounce-body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="n">normal</span><span class="p">)))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>To try out the new code, we can create a simple scene with just the walls and the space ship and see how it moves around:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vright</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vleft</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-width</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vdown</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vup</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-height</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">run-game-loop</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a052/ship.gif" alt="" />
 <p class="caption"></p></div>

<h2 id="colliding-with-asteroids">Colliding with Asteroids</h2>

<p>If we add asteroids to the scene, the ship will fly through them, since there is no collision handler between the ship and asteroids. We can add a collision handler just as we did for the asteroid-asteroid collision, by simply using <code>bodies-collide?</code> function to determine if the body of the ship collides with the body of the asteroid. However, in case of the space ship, this test is too strict since, unlike the asteroids, the ship does not resemble a circle. To make the collision test more sensitive, once we have determined that the bodies collide, we can check if any of the points representing the ship is actually inside the asteroid. This way, we have a fast, but coarse collision test first, and if that one succeeds we have a somewhat slower but more precise test. When a collision happens, the space ship actor is simply removed from the scene:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">handle-space-ship-asteroid-collision</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">collision?</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="p">(</span><span class="n">bodies-collide?</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" style="color: inherit">let*</a></span><span class="w"> </span><span class="p">([</span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">s-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">s-center</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">s-body</span><span class="p">)])</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" style="color: inherit">for/or</a></span><span class="w"> </span><span class="p">([</span><span class="n">point</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">space-ship-points</span><span class="p">)])</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" style="color: inherit">match-define</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="n">body-point-collision?</span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">s-center</span><span class="p">))))))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="n">collision?</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span><span class="w"></span>

<span class="p">(</span><span class="n">add-collision-handler</span><span class="w"> </span><span class="n">space-ship%</span><span class="w"> </span><span class="n">asteroid%</span><span class="w"> </span><span class="n">handle-space-ship-asteroid-collision</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And here is the <code>body-point-collision?</code> function, which checks is a single point is inside the radius of a body:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">body-point-collision?</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">centre-to-point-distance</span><span class="w"> </span><span class="p">(</span><span class="n">vlength</span><span class="w"> </span><span class="p">(</span><span class="n">vminus</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">b</span><span class="p">))))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">centre-to-point-distance</span><span class="w"> </span><span class="p">(</span><span class="n">body-radius</span><span class="w"> </span><span class="n">b</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can add back our sample asteroids into the scene to test if the new code is working, but, if you try to run the program so far, you&rsquo;ll notice that there is no good visual indication of the collision, and while the program behaves correctly and the ship disappears, it is not very intuitive for the user:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vright</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vleft</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-width</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vdown</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vup</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-height</span><span class="p">]))</span><span class="w"></span>

<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="mi">100</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">550</span><span class="w"> </span><span class="mi">200</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">550</span><span class="w"> </span><span class="mi">500</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">run-game-loop</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<h2 id="explosions">Explosions</h2>

<p>To improve the visual look of the game, we can create an <code>explosion%</code> actor &mdash; this will be a purely visual actor, which will not interact with any other actors and will display a set of expanding bubbles that all &ldquo;emerge&rdquo; from a specified position. The actor has the familiar <code>update/delta-time</code> and <code>paint</code> methods: bubbles are updated according to their position, direction and speed and drawn on the screen as circles.</p>

<p>Since it does not interact with anything else, the <code>explosion%</code> actor will remain in the scene forever. To limit this, we can define a life-time for this actor: number of milliseconds the explosion lasts and once this life time expires, the actor removes itself from the scene.</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" style="color: inherit">struct</a></span><span class="w"> </span><span class="n">bubble</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">speed</span><span class="p">)</span><span class="w"> </span><span class="kd">#:transparent</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">explosion%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init-field))" style="color: inherit">init-field</a></span><span class="w"> </span><span class="n">position</span><span class="w">               </span><span class="c1">; position where the explosion happened</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">bubble-count</span><span class="w"> </span><span class="mi">50</span><span class="p">]</span><span class="w">      </span><span class="c1">; number of bubbles to draw</span><span class="w"></span>
<span class="w">                </span><span class="c1">;; life time of the explosion, the object is removed after</span><span class="w"></span>
<span class="w">                </span><span class="c1">;; this amount of time</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">life-time</span><span class="w"> </span><span class="mi">2000</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">bubbles</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" style="color: inherit">for/list</a></span><span class="w"> </span><span class="p">([</span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-range))" style="color: inherit">in-range</a></span><span class="w"> </span><span class="n">bubble-count</span><span class="p">)])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">bubble</span><span class="w"> </span><span class="n">position</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/private/base..rkt)._random))" style="color: inherit">random</a></span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="n">random-around</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="kd">#:nudge</span><span class="w"> </span><span class="mf">0.5</span><span class="p">))))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a></span><span class="p">)</span><span class="w">           </span><span class="c1">; we&#39;re done, remove ourselves from the scene</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">bubbles</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" style="color: inherit">for/list</a></span><span class="w"> </span><span class="p">([</span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">bubbles</span><span class="p">)])</span><span class="w"></span>
<span class="w">                  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" style="color: inherit">match-define</a></span><span class="w"> </span><span class="p">(</span><span class="n">bubble</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">speed</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="p">(</span><span class="n">bubble</span><span class="w"></span>
<span class="w">                   </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">dt</span><span class="p">)))</span><span class="w"></span>
<span class="w">                   </span><span class="n">direction</span><span class="w">            </span><span class="c1">; does not change</span><span class="w"></span>
<span class="w">                   </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mf">1.02</span><span class="p">)</span><span class="w">        </span><span class="c1">; bubble size grows with time</span><span class="w"></span>
<span class="w">                   </span><span class="n">speed</span><span class="p">)))))</span><span class="w">           </span><span class="c1">; speed does not change</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">the-pen-list</span><span class="w"> </span><span class="n">find-or-create-pen</span><span class="w"> </span><span class="s2">"darkslategray"</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">'</span><span class="ss">solid</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">paint</span><span class="w"> </span><span class="n">_canvas</span><span class="w"> </span><span class="n">dc</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">old-pen</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">get-pen</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-pen</span><span class="w"> </span><span class="n">pen</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">bubbles</span><span class="p">)])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" style="color: inherit">match-define</a></span><span class="w"> </span><span class="p">(</span><span class="n">bubble</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">_d</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">_e</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">draw-ellipse</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="p">(</span><span class="n">v2-x</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="p">(</span><span class="n">v2-y</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-pen</span><span class="w"> </span><span class="n">old-pen</span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Finally, we can update the <code>handle-space-ship-asteroid-collision</code> function to create an explosion at the position where the space ship used to be:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">handle-space-ship-asteroid-collision</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">collision?</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="p">(</span><span class="n">bodies-collide?</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" style="color: inherit">let*</a></span><span class="w"> </span><span class="p">([</span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">s-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">s-center</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">s-body</span><span class="p">)])</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/or))" style="color: inherit">for/or</a></span><span class="w"> </span><span class="p">([</span><span class="n">point</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">space-ship-points</span><span class="p">)])</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" style="color: inherit">match-define</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">)</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="n">body-point-collision?</span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">s-center</span><span class="p">))))))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="n">collision?</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; Add the explosion</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">explosion%</span><span class="w"> </span><span class="p">[</span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-body</span><span class="p">))]))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And here is the end result:</p>

<div class="figure"><img src="/img/a052/collision.gif" alt="" />
 <p class="caption"></p></div>

<h2 id="shooting-missiles">Shooting Missiles</h2>

<p>Since the asteroids can destroy the space ship when they collide with it, it is only fair to allow the ship to destroy asteroids. The way that works in the game is that the ship can shoot missiles, which, when they hit asteroids, break them up into smaller ones and very small asteroids are completely destroyed.</p>

<p>Missiles will be actors which are created by the <code>space-ship%</code> when the user presses the Space key, but otherwise will have a a lifetime of their own, being actors themselves. They also have a physics body, so we can make use of the physics engine for moving them. Here is the <code>missile%</code> actor:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">missile%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init-field))" style="color: inherit">init-field</a></span><span class="w"> </span><span class="n">position</span><span class="w">                </span><span class="c1">; position where the missile starts</span><span class="w"></span>
<span class="w">                </span><span class="n">direction</span><span class="w">               </span><span class="c1">; direction in which it is moving</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">life-time</span><span class="w"> </span><span class="mi">5000</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._length))" style="color: inherit">length</a></span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w">                  </span><span class="c1">; the length of the missile</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">body</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._length))" style="color: inherit">length</a></span><span class="p">))</span><span class="w"></span>
<span class="w">       </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="mf">0.3</span><span class="p">)</span><span class="w">           </span><span class="c1">; direction and speed</span><span class="w"></span>
<span class="w">       </span><span class="n">vzero</span><span class="w">                            </span><span class="c1">; no acceleration</span><span class="w"></span>
<span class="w">       </span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._length))" style="color: inherit">length</a></span><span class="w">                           </span><span class="c1">; radius</span><span class="w"></span>
<span class="w">       </span><span class="mi">0</span><span class="w">                                </span><span class="c1">; no orientation</span><span class="w"></span>
<span class="w">       </span><span class="mi">0</span><span class="w">                                </span><span class="c1">; no angular velocity</span><span class="w"></span>
<span class="w">       </span><span class="mi">1</span><span class="p">))</span><span class="w">                              </span><span class="c1">; no velocity damping</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/public))" style="color: inherit">define/public</a></span><span class="w"> </span><span class="p">(</span><span class="n">get-tip-position</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">life-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a></span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="n">update-body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="n">dt</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="c1">;; Pen used to draw the laser shot</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">the-pen-list</span><span class="w"> </span><span class="n">find-or-create-pen</span><span class="w"> </span><span class="s2">"corflowerblue"</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">'</span><span class="ss">solid</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">paint</span><span class="w"> </span><span class="n">_canvas</span><span class="w"> </span><span class="n">dc</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">old-pen</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">get-pen</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-pen</span><span class="w"> </span><span class="n">pen</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">tip</span><span class="w"> </span><span class="p">(</span><span class="n">get-tip-position</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="p">(</span><span class="n">get-tip-position</span><span class="p">)</span><span class="w"></span>
<span class="w">                          </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="p">(</span><span class="n">vnorm</span><span class="w"> </span><span class="p">(</span><span class="n">body-velocity</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"></span>
<span class="w">                                  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">(</span><span class="n">body-radius</span><span class="w"> </span><span class="n">the-body</span><span class="p">)))))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">draw-line</span><span class="w"> </span><span class="p">(</span><span class="n">v2-x</span><span class="w"> </span><span class="n">tip</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">v2-y</span><span class="w"> </span><span class="n">tip</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">v2-x</span><span class="w"> </span><span class="n">tail</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">v2-y</span><span class="w"> </span><span class="n">tail</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-pen</span><span class="w"> </span><span class="n">old-pen</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Missiles are created by the space ship when the user presses and holds the Space key and, just like with the moving keys we&rsquo;ll keep track of when the user presses and releases the key, shooting missiles repeteadly while the Space key is held down:</p>

<ul>
 <li>the new <code>shooting?</code> member of the <code>space-ship%</code> class is a flag indicating  that the space ship is shooting. It is set and cleared in response to  keyboard events in <code>keyboard-event</code></li>
 <li>the new <code>repeat-shoot-time</code> holds the time remaining until the next missile  launch and it is decremented in <code>update/delta-time</code> &mdash; when this timer  reaches 0 and <code>shooting?</code> is <code>#t</code> a new missile object is created.</li>
 <li>the <code>update/delta-time</code> method is updated to create <code>missile%</code> actors if  needed</li>
 <li>the <code>keyboard-event</code> method is updated to look for Space key presses and  releases.</li></ul>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship-shoot-interval</span><span class="w"> </span><span class="mi">250</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; Rest of the space-ship% class is unchanged</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">shooting?</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span><span class="w">    </span><span class="c1">;; When #t, the ship is shooting missiles</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="n">update-body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="c1">;; When the ship is shooting, check the repeat-shoot-time and create</span><span class="w"></span>
<span class="w">      </span><span class="c1">;; missile% objects</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="n">shooting?</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c~3d))" style="color: inherit">&lt;=</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="n">space-ship-shoot-interval</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="p">(</span><span class="n">vrotate</span><span class="w"> </span><span class="n">vright</span><span class="w"> </span><span class="p">(</span><span class="n">body-orientation</span><span class="w"> </span><span class="n">the-body</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="p">(</span><span class="n">body-radius</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">missile%</span><span class="w"></span>
<span class="w">                          </span><span class="p">[</span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">scale</span><span class="p">))]</span><span class="w"></span>
<span class="w">                          </span><span class="p">[</span><span class="n">direction</span><span class="w"> </span><span class="n">direction</span><span class="p">])))))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">keyboard-event</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">get-key-code</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">left</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mf">-0.005</span><span class="p">])))</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">right</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mf">0.005</span><span class="p">])))</span><span class="w"></span>
<span class="w">        </span><span class="p">((</span><span class="n">up</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="p">(</span><span class="n">vrotate</span><span class="w"> </span><span class="n">vright</span><span class="w"> </span><span class="p">(</span><span class="n">body-orientation</span><span class="w"> </span><span class="n">the-body</span><span class="p">))</span><span class="w"> </span><span class="mf">0.001</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">acceleration</span><span class="w"> </span><span class="n">a</span><span class="p">])))</span><span class="w"></span>

<span class="w">        </span><span class="p">((</span><span class="sc">#\space</span><span class="p">)</span><span class="w">                     </span><span class="c1">;; Start shooting missiles</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">shooting?</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="p">((</span><span class="n">release</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">get-key-release-code</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" style="color: inherit">member</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="ss">left</span><span class="w"> </span><span class="ss">right</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">angular-velocity</span><span class="w"> </span><span class="mi">0</span><span class="p">])))</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" style="color: inherit">member</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="ss">up</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/struct-copy.html#(form._((lib._racket/private/base..rkt)._struct-copy))" style="color: inherit">struct-copy</a></span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">the-body</span><span class="w"> </span><span class="p">[</span><span class="n">acceleration</span><span class="w"> </span><span class="n">vzero</span><span class="p">])))</span><span class="w"></span>

<span class="w">         </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" style="color: inherit">member</a></span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="sc">#\space</span><span class="p">))</span><span class="w"> </span><span class="c1">;; Stop Shooting Missiles</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">shooting?</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">repeat-shoot-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)))))</span><span class="w"></span>

<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>A missile will collide with asteroids, so we need to add a collision handler for this case. In case of the missile, we check if the tip of the missile is inside the asteroid using the <code>body-point-collision?</code> defined previously. When an asteroid is hit by a missile, we remove it from the scene, along with the missile and replace them with an <code>explosion%</code>. Also, if the asteroid was big enough, we add three smaller asteroids to replace it:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">handle-asteroid-missile-collision</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">))</span><span class="w"></span>

<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="n">body-point-collision?</span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">get-tip-position</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w">                   </span><span class="c1">; This asteroid is no more</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">remove-actor</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w">                   </span><span class="c1">; ... and neither is the missile</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">explosion%</span><span class="w"> </span><span class="p">[</span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">a-body</span><span class="p">)]))</span><span class="w"> </span><span class="c1">; add an explosion</span><span class="w"></span>

<span class="w">    </span><span class="c1">;; Add some smaller asteroids to the scene</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">(</span><span class="n">body-radius</span><span class="w"> </span><span class="n">a-body</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">new-size</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mf">0.60</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">body-position</span><span class="w"> </span><span class="n">a-body</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="p">(</span><span class="n">vnorm</span><span class="w"> </span><span class="p">(</span><span class="n">body-velocity</span><span class="w"> </span><span class="n">a-body</span><span class="p">)))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">size</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">rotation</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))" style="color: inherit">pi</a></span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))" style="color: inherit">pi</a></span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">)))])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">new-position</span><span class="w"> </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">(</span><span class="n">vrotate</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="n">rotation</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                        </span><span class="p">[</span><span class="n">size</span><span class="w"> </span><span class="n">new-size</span><span class="p">]</span><span class="w"></span>
<span class="w">                        </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="n">new-position</span><span class="p">]))))))</span><span class="w"></span>

<span class="p">(</span><span class="n">add-collision-handler</span><span class="w"> </span><span class="n">asteroid%</span><span class="w"> </span><span class="n">missile%</span><span class="w"> </span><span class="n">handle-asteroid-missile-collision</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Putting the initial asteroids back into the scene, we now have a functional Asteroids game:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vright</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vleft</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-width</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vdown</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vup</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-height</span><span class="p">]))</span><span class="w"></span>

<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="mi">100</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">550</span><span class="w"> </span><span class="mi">200</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="mi">550</span><span class="w"> </span><span class="mi">500</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">)]</span><span class="w"></span>
<span class="w">                </span><span class="p">[</span><span class="n">initial-speed</span><span class="w"> </span><span class="mf">0.05</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">run-game-loop</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a052/shooting.gif" alt="" />
 <p class="caption"></p></div>

<h2 id="sourcing-asteroids">Sourcing Asteroids</h2>

<p>So far, in our scene we have always added three asteroids which started at predefined positions. This makes the game predictable and, as the space ship shoots the asteroids, eventually there will be no more asteroids in the scene. We need a way to create new asteroids as existing ones are destroyed and we can do this by having an actor which monitors the amount of asteroids in the scene and creates new ones when this amount runs low.</p>

<p>To determine the total amount of asteroids in the scene, we can iterate over all the asteroids and calculate the sum of their areas (this is more predictable than simply summing their radius):</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">total-asteroid-area</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/sum))" style="color: inherit">for/sum</a></span><span class="w"> </span><span class="p">([</span><span class="n">actor</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">the-scene</span><span class="p">)]</span><span class="w"> </span><span class="kd">#:when</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objectutils.html#(def._((lib._racket/private/class-internal..rkt)._is-a~3f))" style="color: inherit">is-a?</a></span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="n">asteroid%</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="p">(</span><span class="n">body-radius</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="n">get-body</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._pi))" style="color: inherit">pi</a></span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="n">radius</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The <code>asteroid-spawner%</code> actor will use its <code>update/delta-time</code> method to check if the total asteroid area is less than a specified threshold, <code>min-total-area</code>, and create a new asteroid by calling <code>spawn-asteroid</code>. Calculating the total asteroid area is an expensive operation and this value does not change that often (certainly not 60 times each second). To reduce the computing resources, the <code>asteroid-spawner%</code> only does its checks at predefined intervals (once a second by default), and it keeps track of this using a counter, <code>remaining-time</code> which is decremented each time <code>update/delta-time</code> is called.</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">asteroid-spawner%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init-field))" style="color: inherit">init-field</a></span><span class="w"></span>
<span class="w">     </span><span class="p">[</span><span class="n">spawn-rate</span><span class="w"> </span><span class="mi">1000</span><span class="p">]</span><span class="w"></span>
<span class="w">     </span><span class="p">[</span><span class="n">min-total-area</span><span class="w"> </span><span class="mi">70000</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">remaining-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">; time until next check</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">remaining-time</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">remaining-time</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">remaining-time</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">total-area</span><span class="w"> </span><span class="p">(</span><span class="n">total-asteroid-area</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">total-area</span><span class="w"> </span><span class="n">min-total-area</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">spawn-asteroid</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">remaining-time</span><span class="w"> </span><span class="n">spawn-rate</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Finally, the <code>spawn-asteroid</code> function is responsible for adding a new asteroid to the scene. To make it appear that asteroids come from &ldquo;outside&rdquo;, it selects a random position on the screen and calculates a position outside the screen such that the asteroid moves towards the target:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">spawn-asteroid</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/private/base..rkt)._random))" style="color: inherit">random</a></span><span class="w"> </span><span class="n">canvas-width</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/private/base..rkt)._random))" style="color: inherit">random</a></span><span class="w"> </span><span class="n">canvas-height</span><span class="p">)))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="p">(</span><span class="n">random-direction</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">position</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">vplus</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">(</span><span class="n">vscale</span><span class="w"> </span><span class="p">(</span><span class="n">vnegate</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._max))" style="color: inherit">max</a></span><span class="w"> </span><span class="n">canvas-width</span><span class="w"> </span><span class="n">canvas-height</span><span class="p">))))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid%</span><span class="w"></span>
<span class="w">                  </span><span class="p">[</span><span class="n">initial-position</span><span class="w"> </span><span class="n">position</span><span class="p">]</span><span class="w"></span>
<span class="w">                  </span><span class="p">[</span><span class="n">initial-direction</span><span class="w"> </span><span class="n">direction</span><span class="p">])))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can now replace the three initial asteroids in our scene with a single <code>asteroid-spawner%</code> actor: when it initially runs, it will notice that the scene is empty and start spawning asteroids and it will keep spawning new ones as old ones are destroyed.</p>

<h2 id="keeping-spares">Keeping Spares</h2>

<p>Many games have a concept of &ldquo;lives&rdquo;: then the space ship is destroyed the user gets a second chance (and a third one too). This concept can be implemented using yet another actor: the <code>spares%</code> actor checks periodically if a space ship is still present in the scene and creates a new space ship or changes the game outcome to <code>'game-over</code> if the user ran out of spare ships.</p>

<p>The <code>spares%</code> actor also displays the number of total and remaining spare ships in the top right corner of the game window (and uses bodies and models to do the drawing):</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">spares%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init-field))" style="color: inherit">init-field</a></span><span class="w"> </span><span class="p">[</span><span class="n">initial</span><span class="w"> </span><span class="mi">5</span><span class="p">])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">initial</span><span class="p">)</span><span class="w"> </span><span class="c1">; Spare space ships still remaining</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">check-interval</span><span class="w"> </span><span class="mi">3000</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">; Remaining time until next check</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="n">cooldown</span><span class="w"> </span><span class="n">check-interval</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">ship</span><span class="w">                    </span><span class="c1">; try to find the ship in the scene</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/first))" style="color: inherit">for/first</a></span><span class="w"> </span><span class="p">([</span><span class="n">actor</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">the-scene</span><span class="p">)]</span><span class="w"></span>
<span class="w">                      </span><span class="kd">#:when</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objectutils.html#(def._((lib._racket/private/class-internal..rkt)._is-a~3f))" style="color: inherit">is-a?</a></span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">actor</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._unless))" style="color: inherit">unless</a></span><span class="w"> </span><span class="n">ship</span><span class="w">                    </span><span class="c1">; there is no ship!</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w"></span>
<span class="w">              </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">game-outcome</span><span class="w"> </span><span class="o">'</span><span class="ss">game-over</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" style="color: inherit">sub1</a></span><span class="w"> </span><span class="n">remaining</span><span class="p">)))))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="n">space-ship-scale</span><span class="w"> </span><span class="mf">0.75</span><span class="p">))</span><span class="w"> </span><span class="c1">; draw smaller ships for the spares</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">bodies</span><span class="w"> </span><span class="c1">; physics bodies used for spare space ships, used so we can use `draw-model`</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" style="color: inherit">for/list</a></span><span class="w"> </span><span class="p">([</span><span class="n">index</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-range))" style="color: inherit">in-range</a></span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">-1</span><span class="p">)])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">canvas-width</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="n">scale</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">scale</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="n">v2</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">vzero</span><span class="w"> </span><span class="n">vzero</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">remaining-pen</span><span class="w"> </span><span class="p">(</span><span class="n">make-scaled-pen</span><span class="w"> </span><span class="s2">"teal"</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">scale</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">used-pen</span><span class="w"> </span><span class="p">(</span><span class="n">make-scaled-pen</span><span class="w"> </span><span class="s2">"dark gray"</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">scale</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">paint</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="n">dc</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">bodies</span><span class="p">)]</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-naturals))" style="color: inherit">in-naturals</a></span><span class="p">)])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e~3d))" style="color: inherit">&gt;=</a></span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="n">remaining</span><span class="p">)</span><span class="w"> </span><span class="n">used-pen</span><span class="w"> </span><span class="n">remaining-pen</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="n">draw-model</span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">space-ship-path</span><span class="w"> </span><span class="n">pen</span><span class="w"> </span><span class="n">body</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The <code>spares%</code> actor will add new space ships in the middle of the screen, but during a game, there might be asteroids at that location, causing an instant collision, which is unfair to the player. We could find an empty spot on the screen and place the ship there, but a simpler approach is to make the ship indestructible for a short period of time after it is created &mdash; this will allow the user to move to a safe position before this indestructible period runs out.</p>

<p>This &ldquo;cooldown&rdquo; mechanism is implemented in two steps: first the <code>space-ship%</code> object maintains a &ldquo;cooldown&rdquo; counter which is initialized to an arbitrary value (5 seconds in the game) and decremented in the <code>update/delta-time</code> method of the ship class. The space ship - asteroid collision handler, <code>handle-space-ship-asteroid-collision</code>, checks this cooldown value and only runs if the cooldown is zero, that is, it only checks for collisions after the cooldown period has passed. In addition to this, to give the user a visual cue that the ship is invincible, a circle is drawn around the ship in the <code>space-ship%</code>&rsquo;s <code>paint</code> method. To keep the blog post shorter, the implementation will not be shown here, but you can check out the <a href="https://gist.github.com/alex-hhh/93f4e3ae35e0050ded74e9341dbc2824">GitHub gist</a> for the full game.</p>

<h2 id="counting-the-score">Counting the Score</h2>

<p>Every game needs to keep score, how else would players be able to compare their skill level? In the asteroids game, the simple way to keep score is to award points for each asteroid that is destroyed, with more points awarded for destroying smaller ones, since they are harder to hit. We&rsquo;ll keep the score in the global <code>game-score</code> variable and update it in the <code>handle-asteroid-missile-collision</code> function:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">game-score</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">handle-asteroid-missile-collision</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">get-body</span><span class="p">))</span><span class="w"></span>

<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="n">body-point-collision?</span><span class="w"> </span><span class="n">a-body</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">get-tip-position</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; Rest of the `handle-asteroid-missile-collision` body is unchanged</span><span class="w"></span>

<span class="w">    </span><span class="c1">;; Update the game score -- user gets more points for hitting a smaller</span><span class="w"></span>
<span class="w">    </span><span class="c1">;; asteroid.</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">game-score</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="n">game-score</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._max))" style="color: inherit">max</a></span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">100</span><span class="p">)))))))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>To display the score, we can use another actor, whose <code>paint</code> function will draw the score in the top left corner of the screen. To make it more interesting, the displayed score will lag behind the actual game score and will be updated in the <code>update/delta-time</code> method &mdash; this will produce the pleasing &ldquo;counting up&rdquo; effect for the number shown on the screen:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">game-score%</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="n">actor%</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._init))" style="color: inherit">init</a></span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._super-new))" style="color: inherit">super-new</a></span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">                </span><span class="c1">; the game score we actually display.</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">update/delta-time</span><span class="w"> </span><span class="n">_dt</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="n">game-score</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">difference</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span><span class="w"> </span><span class="n">game-score</span><span class="w"> </span><span class="n">displayed</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._exact-truncate))" style="color: inherit">exact-truncate</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mf">0.10</span><span class="w"> </span><span class="n">difference</span><span class="p">))))))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">text-font</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">the-font-list</span><span class="w"> </span><span class="n">find-or-create-font</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="o">'</span><span class="ss">default</span><span class="w"> </span><span class="o">'</span><span class="ss">normal</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._define/override))" style="color: inherit">define/override</a></span><span class="w"> </span><span class="p">(</span><span class="n">paint</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="n">dc</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7ea))" style="color: inherit">~a</a></span><span class="w"> </span><span class="n">displayed</span><span class="w"> </span><span class="kd">#:width</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="kd">#:left-pad-string</span><span class="w"> </span><span class="s2">"0"</span><span class="w"> </span><span class="kd">#:align</span><span class="w"> </span><span class="o">'</span><span class="ss">right</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">old-font</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">get-font</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-font</span><span class="w"> </span><span class="n">text-font</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">draw-text</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">dc</span><span class="w"> </span><span class="n">set-font</span><span class="w"> </span><span class="n">old-font</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<h2 id="everything-together">Everything Together</h2>

<p>With all the actors set up, we can create the scene adding initial actors and run the game (you can find the fill implementation in this <a href="https://gist.github.com/alex-hhh/93f4e3ae35e0050ded74e9341dbc2824">GitHub gist</a>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">space-ship%</span><span class="p">))</span><span class="w">           </span><span class="c1">; our space ship</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">spares%</span><span class="w"> </span><span class="p">[</span><span class="n">initial</span><span class="w"> </span><span class="mi">3</span><span class="p">]))</span><span class="w">   </span><span class="c1">; add some spare ships</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">game-score%</span><span class="p">))</span><span class="w">           </span><span class="c1">; show the game score</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">asteroid-spawner%</span><span class="p">))</span><span class="w">     </span><span class="c1">; someone has to produce the asteroids</span><span class="w"></span>

<span class="c1">;; These are the walls making up the scene, everything bounces inside these</span><span class="w"></span>
<span class="c1">;; walls.</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vright</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vleft</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-width</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vdown</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="mi">0</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="n">add-actor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">wall%</span><span class="w"> </span><span class="p">[</span><span class="n">normal</span><span class="w"> </span><span class="n">vup</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">distance</span><span class="w"> </span><span class="n">canvas-height</span><span class="p">]))</span><span class="w"></span>

<span class="p">(</span><span class="n">run-game-loop</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And here is me playing the game:</p>

<hr />

<div style="text-align:center">
 <iframe width="700" height="422" src="https://www.youtube.com/embed/XWZ7dkkNi3o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div>

<hr />

<h2 id="final-thoughts">Final Thoughts</h2>

<p>This has been a long blog post, but the <a href="https://gist.github.com/alex-hhh/93f4e3ae35e0050ded74e9341dbc2824">actual implementation</a> is still relatively small and self contained: both the game engine and the game itself are implemented in about 1000 lines of Racket code. I found the &ldquo;Actor&rdquo; concept an interesting one and it can be used in creative ways to implement an entire game. Apart from obvious actors such as asteroids and space ships, the game score and spare lives are also implemented as actors. Here is the full list once more:</p>

<ul>
 <li><code>asteroid%</code> &mdash; this is the most recognizable actor, it can draw asteroids  and use the physics engine to move them around and collide with other things</li>
 <li><code>ship%</code> &mdash; this is another obvious actor, representing the space ship. In  addition to the functionality of the asteroid for drawing and moving, it can  also respond to user input to change its acceleration or to create  <code>missile%</code> actors.</li>
 <li><code>missile%</code> &mdash; representing missiles as actors means that we can let the game  engine manage multiple missiles in the scene and we don&rsquo;t have to worry  about doing that ourselves.</li>
 <li><code>wall%</code> &mdash; to keep asteroids and space ship inside a playing field, we used  a wall actor whose sole purpose is to act as a collision target for  asteroids and ship.</li>
 <li><code>asteroid-spawner%</code> &mdash; a simple actor which monitors the scene and  introduces new asteroids if the supply is low</li>
 <li><code>explosion%</code> &mdash; an actor to display the animation for an &ldquo;explosion&rdquo; &mdash; yes,  bubbles are not very realistic, I know.</li>
 <li><code>game-score%</code> &mdash; an actor that displays the game score &mdash; since the score is  displayed using an animation which makes the counter roll up, it is simpler  to just make an actor that uses the <code>update/delta-time</code> and <code>paint</code> to do  this.</li>
 <li><code>spares%</code> &mdash; an actor which monitors the scene and add another space ship if  the current one is destroyed, this is used to implement the concept of  &ldquo;lives&rdquo; in the game and allow the user a second chance when their ship is  destroyed.</li></ul>
  <footer>
    <div class="fine-print">© Alex Harsányi, licensed under
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      , and there's a <a href="/Cookies.html">cookie policy</a>.
    </div>
    <div class="row justify-content-center">
      <nav aria-label="Page Navigation">
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="/2021/10/asteroids-part-1.html"
               aria-label="Previous">
              <span aria-hidden="true">&larr; Asteroids (Game Engine)</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="/2022/05/heat-maps-revisited.html"
               aria-label="Next">
              <span aria-hidden="true">Heat Maps Revisited &rarr;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </footer>
</article>
        </div>
        <div id="sidebar-content" class="col-md-3">
          <!-- will be filled in dynamically by custom.js -->
        </div>

      </div>

    </div>
    <!-- </body> JS -->
  <!-- NOTE: jQuery must be loaded first -->
  <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="/js/custom.js"></script>
  </body>
</html>