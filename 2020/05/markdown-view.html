<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Markdown View using the Racket editor%</title>
    <meta name="description" content="The Racket text% editor class can be used to display multi line text with formatting, such as fonts and colors; it is however, somewhat difficult to set it up and use its formatting capabilities. This blog post shows how to build a text view which allows ...">
    <meta name="author"      content="Alex Harsányi">
    <meta name="keywords"    content="racket">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="canonical" href="https://alex-hhh.github.io/2020/05/markdown-view.html">
    <link rel="next" href="/2020/05/dependency-management-in-racket-applications.html">
    <link rel="prev" href="/2020/06/ishido.html">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono&display=swap" rel="stylesheet">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script src="/main.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110325732-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-110325732-1');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container">
        <a href="/index.html" class="navbar-brand">Alex Harsányi</a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbar_collapse" aria-controls="navbar_collapse"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item dropdown">
              <a href="#"
                 class="nav-link dropdown-toggle"
                 data-bs-toggle="dropdown"
                 aria-expanded="false">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu" role="menu" id="tags-menu-content">
                <!-- will be filled in dynamically by custom.js -->
              </ul>
            </li>
            <li>
              <a class="nav-link" href="/About.html">About</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/arduino.html">Arduino</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/racket.html">Racket</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/activitylog2.html">ActivityLog2</a>
            </li> 
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">

        <!-- Main column -->
        <!-- NOTE: there is a bug in the web server template renderer which
             indents all items inside if blocks.  This means that we cannot
             put the contents inside an if block, as all the <pre> tags will
             be indented.
          -->
        <div id="content" class=col-md-9>





          <article>
  <header>
    <h1>Markdown View using the Racket editor%</h1>
    <p class='date-and-tags'>
<time datetime="2020-05-30" pubdate="true">2020-05-30</time> :: <span class="tags"><a href="/tags/racket.html">racket</a></span></p>
  </header>

<p>The Racket <a href="https://docs.racket-lang.org/gui/text_.html">text%</a> editor class can be used to display multi line text with formatting, such as fonts and colors; it is however, somewhat difficult to set it up and use its formatting capabilities. This blog post shows how to build a text view which allows inserting markdown text and the result will be formatted, with headers, links and images.</p>
<!-- more-->

<p>Building a Markdown viewer with a complete set of features is a topic that is too complex for a blog post, but the techniques presented here can be used to add rich text controls to a GUI application. They are especially useful for displaying user instructions with images and links the user can click on.</p>

<h2 id="text-editor-classes-overview">Text Editor Classes Overview</h2>

<p>Below is a basic example, which sets up a simple window displaying a <code>text%</code> instance with some text. It creates a toplevel frame for the application, a <code>canvas</code> to display the text and a <code>text</code> instance, which is used to hold the text to be displayed.</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="kn">#lang </span><span class="nn">racket/gui</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">toplevel</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">frame%</span><span class="w"> </span><span class="p">[</span><span class="n">label</span><span class="w"> </span><span class="s2">"MD View"</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">width</span><span class="w"> </span><span class="mi">400</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">height</span><span class="w"> </span><span class="mi">300</span><span class="p">]))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">editor-canvas%</span><span class="w"> </span><span class="p">[</span><span class="n">parent</span><span class="w"> </span><span class="n">toplevel</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">style</span><span class="w"> </span><span class="o">'</span><span class="p">(</span><span class="ss">no-hscroll</span><span class="p">)]))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">text%</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="n">set-editor</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">auto-wrap</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">set-padding</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">toplevel</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Strings cannot be directly inserted into the text editor, instead, <code>string-snip%</code> objects need to be created for this purpose. For example, the code below will insert a paragraph of text:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">lorem-ipsum</span><span class="w"> </span><span class="sh">#&lt;&lt;EOS</span>
<span class="sh">Add text paragraphs here</span>
<span class="sh">EOS</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">string-snip%</span><span class="w"> </span><span class="n">lorem-ipsum</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The output of this program is shown below. It is not particularly interesting, but even this simple program will be able to re-flow the text to fit the display size:</p>

<div class="figure"><img src="/img/a039/md0.png" alt="" />
 <p class="caption"></p></div>

<h3 id="applying-styles-to-the-text">Applying styles to the text</h3>

<p>The appearance of text in an editor can be changed by applying a <a href="https://docs.racket-lang.org/gui/style-delta_.html">style-delta%</a> to a section of the text in the text editor. A <code>style-delta%</code> is an object which describes how the text appearance should change from the style which is already set, that is, it can be set to change the color, or size of the font, without affecting the background color or the font family.</p>

<p>There are many options that can be changed on a <code>style-delta%</code>, but here is a small example, which changes the font family, makes the font bigger and colors the font blue:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">custom-style</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-face</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-size-add</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-foreground</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span><span class="mi">119</span><span class="w"> </span><span class="mi">170</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>A style delta by itself does not do anything, but it can be applied to a section of the text using the <code>change-style</code> function. While we&rsquo;re at it we can write a small helper function which inserts a string in the editor and applies a style to it:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-and-apply-style</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">style</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">((</span><span class="n">start</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">string-snip%</span><span class="w"> </span><span class="n">text</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">change-style</span><span class="w"> </span><span class="n">style</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="no">#f</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can now insert our text paragraph directly with the custom style, to obtain the result below:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-and-apply-style</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">lorem-ipsum</span><span class="w"> </span><span class="n">custom-style</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md1.png" alt="" />
 <p class="caption"></p></div>

<h3 id="stacking-style-deltas">Stacking style deltas</h3>

<p>Multiple <code>style-delta%</code> objects can be applied to a section of the text, and this can be useful when we want to stack them. For example, we can define a style delta which makes the text <strong>bold</strong>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">bold-style</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="w"> </span><span class="o">'</span><span class="ss">change-bold</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>&hellip; and we can refine out function to apply a list of styles instead of just one:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">styles</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">((</span><span class="n">start</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">string-snip%</span><span class="w"> </span><span class="n">text</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">style</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">styles</span><span class="p">)])</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">change-style</span><span class="w"> </span><span class="n">style</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="no">#f</span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>With this, we can call this function multiple times, to apply a different set of styles to each section of the text we want to insert:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"This is large blue text "</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">custom-style</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"this part is bold "</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">custom-style</span><span class="w"> </span><span class="n">bold-style</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">", while <a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a> one reverted to default "</span><span class="w"> </span><span class="o">'</span><span class="p">())</span><span class="w"></span>
<span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">", <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> the <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._last))" style="color: inherit">last</a> bit is bold, but <a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" style="color: inherit">not</a> blue"</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">bold-style</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md2.png" alt="" />
 <p class="caption"></p></div>

<h2 id="markdown-markup">Markdown Markup</h2>

<p>We can define many style deltas and use the <code>insert-and-apply-styles</code> function to construct an arbitrarily formatted text for the text editor. However, it is not a convenient method to use (even if we would make the name of our function shorted. It would be nice if we could define a function which takes markup from the text and formats it. So, for example, inserting a text such as:</p>

<div class="brush: markdown">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="gh"># Overview</span>

This document showcases the <span class="gs">**Markdown View**</span> and it is available as a [<span class="nt">blog</span>
<span class="nt">post</span>](<span class="na">https://alex-hhh.github.io/2020/05/markdown-view.html</span>)

<span class="gh"># Implementation details</span>

<span class="k">1.</span> first step
<span class="k">1.</span> second step
    <span class="k">*</span> substep one
    <span class="k">*</span> substep two
<span class="k">3.</span> third step
</pre></div></td></tr></tbody></table></div>

</div>

<p>would produce the following content in the text view, complete with a click-able link for the &ldquo;blog post&rdquo; part of the text:</p>

<div class="figure"><img src="/img/a039/md-sample.png" alt="" />
 <p class="caption"></p></div>

<p>The format of the text above is, of course, not chosen arbitrarily, it is <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> formatted text, and the nice thing about this, is that there is already a <a href="https://pkgs.racket-lang.org/package/markdown">Racket package</a> written by <a href="https://www.greghendershott.com/">Greg Hendershott</a> which can parse such documents and produce a data structure which can be used to construct the actual styling in the text editor:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" style="color: inherit">require</a></span><span class="w"> </span><span class="n">markdown</span><span class="p">)</span><span class="w"></span>
<span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">md-text</span><span class="w"> </span><span class="s2">"# Overview ..."</span><span class="p">)</span><span class="w"></span>
<span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">parse-markdown</span><span class="w"> </span><span class="n">md-text</span><span class="p">)</span><span class="w"></span>
<span class="o">'</span><span class="p">((</span><span class="ss">h2</span><span class="w"> </span><span class="p">((</span><span class="ss"><a href="http://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#(form._((lib._syntax/parse..rkt)._id))" style="color: inherit">id</a></span><span class="w"> </span><span class="s2">"overview"</span><span class="p">))</span><span class="w"> </span><span class="s2">"Overview"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="ss">p</span><span class="w"></span>
<span class="w">   </span><span class="p">()</span><span class="w"></span>
<span class="w">   </span><span class="s2">"This <a href="http://docs.racket-lang.org/xml/index.html#(def._((lib._xml/main..rkt)._document))" style="color: inherit">document</a> showcases the "</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">strong</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"Markdown View"</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="s2">" <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> it is available as a "</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">a</span><span class="w"></span>
<span class="w">    </span><span class="p">((</span><span class="ss">href</span><span class="w"> </span><span class="s2">"https://alex-hhh.github.io/2020/05/markdown-view.html"</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="s2">"blog post"</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="ss">h2</span><span class="w"> </span><span class="p">((</span><span class="ss"><a href="http://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#(form._((lib._syntax/parse..rkt)._id))" style="color: inherit">id</a></span><span class="w"> </span><span class="s2">"implementation-details"</span><span class="p">))</span><span class="w"> </span><span class="s2">"Implementation details"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="ss">ol</span><span class="w"></span>
<span class="w">   </span><span class="p">()</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">li</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"first step"</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">li</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"second step"</span><span class="w"> </span><span class="p">(</span><span class="ss">ul</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="ss">li</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"substep one"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="ss">li</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"substep two"</span><span class="p">)))</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">li</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"third step"</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<h2 id="using-markdown-as-the-markup-format">Using Markdown as the Markup Format</h2>

<p>To use Markdown formatting in the text editor, we need a function which takes a text string containing Markdown formatting and issues the correct calls to <code>insert-and-apply-styles</code> to setup the document formatting correctly.</p>

<h3 id="bold-italic-and-monospaced-text">Bold, Italic and Monospaced Text</h3>

<p>Even though it is considered a simple document format, Markdown can still be somewhat complex, so we&rsquo;ll start building the markdown view incrementally. The first step is to recognize text which contains <strong>bold</strong>, <em>italic</em> and <code>code</code> text, in strings such as:</p>

<div class="brush: markdown">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span>This is a text which contains a <span class="gs">**bold section**</span>, an <span class="ge">*italic section*</span> and 
a <span class="sb">`monospaced section`</span>.
</pre></div></td></tr></tbody></table></div>

</div>

<p>Calling <code>parse-markdown</code> with the previous text, produces the output:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="o">'</span><span class="p">((</span><span class="ss">p</span><span class="w"></span>
<span class="w">   </span><span class="p">()</span><span class="w"></span>
<span class="w">   </span><span class="s2">"This is a text which contains a "</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">strong</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"bold section"</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="s2">", an "</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">em</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"italic section"</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="s2">" <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> a "</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">code</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"monospaced section"</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="s2">"."</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The data structure is a list of items (there is only one item in there since we only had one paragraph). Each item is a list, where the first element is the name of the item, in our case this is <code>p</code>, which stands for &ldquo;paragraph&rdquo;, a list of attributes, which is empty for our paragraph, followed by the contents. The contents itself contains plain strings mixed with further sub-lists, such as the one marked <code>strong</code>, which indicates that its contents should be displayed as bold. So the markdown parser uses <code>p</code> for a paragraph, <code>strong</code> for sections which should be bold, <code>em</code> for sections which should be italic and <code>code</code> for sections which should be shown in monospaced font.</p>

<p>First, let&rsquo;s write the <code>insert-markdown</code> function which is the entry point for all the Markdown insertion. It takes an editor and a string in Markdown format, parses it and calls <code>insert-md-items</code> on all the items in the document. The function also sets up an initial &ldquo;base style&rdquo; to be used for text, which is passed to <code>insert-md-items</code>. The code which inserts items is wrapped inside <code>begin-edit-sequence/end-edit-sequence</code> calls for the editor, this ensures that the editor will see the insertion as a single operation and will avoid unnecessary display refreshes while the view is set up:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">md-text</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">md</span><span class="w"> </span><span class="p">(</span><span class="n">parse-markdown</span><span class="w"> </span><span class="n">md-text</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">initial-style-list</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a></span><span class="w"> </span><span class="n">base-style</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">begin-edit-sequence</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">md</span><span class="w"> </span><span class="n">initial-style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">end-edit-sequence</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">base-style</span><span class="w">                  </span><span class="c1">; used for default unmodified text</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-face</span><span class="w"> </span><span class="s2">"Calibri"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-size-add</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p><code>insert-md-items</code> itself simply iterates over the items and calls <code>insert-md-item</code> which inserts a single item:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">item</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">items</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The actual work is done in <code>insert-md-item</code> which inserts a single item from the document. If the item is a simple string, it simply calls <code>insert-and-apply-styles</code> function with the current style list, otherwise it checks the type of item it is and recursively attempts to insert the items in the body (this function is mutually recursive with <code>insert-md-items</code>). For each of the markup that we recognize (currently only <code>strong</code>, <code>em</code> and <code>code</code>) we extent the style list with the corresponding style:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">strong</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">strong-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">em</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">em-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">code</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">code-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And here are the corresponding style definitions:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">strong-style</span><span class="w">                </span><span class="c1">; used for bold text</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="w"> </span><span class="o">'</span><span class="ss">change-bold</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">em-style</span><span class="w">                    </span><span class="c1">; used for italic</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="w"> </span><span class="o">'</span><span class="ss">change-style</span><span class="w"> </span><span class="o">'</span><span class="ss">italic</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">code-style</span><span class="w">                  </span><span class="c1">; used for monospaced text</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/objcreation.html#(form._((lib._racket/private/class-internal..rkt)._new))" style="color: inherit">new</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-face</span><span class="w"> </span><span class="s2">"Consolas"</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>It is relatively a small amount of code, but we can already conveniently insert some text which has some formatting in it:</p>

<div class="figure"><img src="/img/a039/md3.png" alt="" />
 <p class="caption"></p></div>

<h3 id="paragraphs-and-headers">Paragraphs and Headers</h3>

<p>Regardless of how many paragraphs we use in the text in the previous example, the text view will re-flow the text as a single paragraph. This is because all newlines in a text editor are &ldquo;soft&rdquo; and the text editor is allowed to reflow the text around them. To create a new paragraph, we need to insert a &ldquo;hard newline&rdquo;, which is a <code>string-snip%</code> with the <code>hard-newline</code> flag attached:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">((</span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">string-snip%</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">set-flags</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="o">'</span><span class="ss">hard-newline</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">get-flags</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can now update <code>insert-md-items</code> to insert two hard newlines it it is called to insert a new paragraph, which is controlled by the <code>paragraph?</code> argument. Currently, then handling the <code>p</code> item in a markdown document, we&rsquo;ll set that parameter to <code>#</code>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="p">(</span><span class="n">paragraph?</span><span class="w"> </span><span class="no">#f</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="n">paragraph?</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" style="color: inherit">not</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" style="color: inherit">zero?</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">))))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">item</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">items</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Since we can now recognize paragraphs, it is quite easy to recognize headers, which in markdown are lines prefixed with "#" characters. The markdown parser will create items with the names <code>h1</code>, <code>h2</code>, all the way to <code>h6</code> for each sub-header level. To make things more interesting, we will use different font sized, but also different colors for the header styles:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="n">font-increase</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="w"> </span><span class="o">'</span><span class="ss">change-bigger</span><span class="w"> </span><span class="n">font-increase</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-background</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-alignment-on</span><span class="w"> </span><span class="o">'</span><span class="ss">base</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-underlined-on</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h1-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">187</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="mi">238</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h2-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="mi">238</span><span class="w"> </span><span class="mi">255</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h3-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="mi">221</span><span class="w"> </span><span class="mi">170</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h4-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">238</span><span class="w"> </span><span class="mi">238</span><span class="w"> </span><span class="mi">187</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h5-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="mi">204</span><span class="p">)))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">h6-style</span><span class="w"> </span><span class="p">(</span><span class="n">make-header-style</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">221</span><span class="w"> </span><span class="mi">221</span><span class="w"> </span><span class="mi">221</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And we can update <code>insert-md-item</code> to recognize the header tags. Note how all header tags pass <code>#t</code> to <code>insert-md-items</code>, since they start new paragraphs:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">strong</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">strong-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">em</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">em-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">code</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">code-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h1</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h1-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h2</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h2-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h3</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h3-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h4</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h4-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h5</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h5-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">h6</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">h6-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The <code>insert-md-items</code> has become somewhat large and repetitive, but it is still manageable in size. The image below shows how headers are rendered, and also shows how styles are composed, since some of the headers contain bold and italic text and this is correctly composed with the size and color of the header, without any special work from our side:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"</span>
<span class="s2"># Header 1 **some bold text**</span>
<span class="s2">## Header 2 *some italic text*</span>
<span class="s2">### Header 3 `some monospaced text`</span>
<span class="s2">#### Header 4</span>
<span class="s2">##### Header 5</span>
<span class="s2">###### Header 6"</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md4.png" alt="" />
 <p class="caption"></p></div>

<h3 id="hyper-links">Hyper-links</h3>

<p>Markdown support hyper-links in the document, and we can add support for these in the markdown view as well. A document with hyper-links is parsed as follows:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">parse-markdown</span><span class="w"> </span><span class="s2">"This is a [link](https://example.com)"</span><span class="p">)</span><span class="w"></span>
<span class="o">'</span><span class="p">((</span><span class="ss">p</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"This is a "</span><span class="w"> </span><span class="p">(</span><span class="ss">a</span><span class="w"> </span><span class="p">((</span><span class="ss">href</span><span class="w"> </span><span class="s2">"https://example.com"</span><span class="p">))</span><span class="w"> </span><span class="s2">"link"</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The link itself is inside an <code>a</code> element, whose body is the link text, while the actual URL is in the attributes section, as the <code>href</code> element.</p>

<p>To implement the hyper-links, let&rsquo;s start with the styles used to represent them in the view. We need two style deltas, one for the hyperlink as is, and one for when the hyperlink is clicked:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">hyperlink-style</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-foreground</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span><span class="mi">119</span><span class="w"> </span><span class="mi">170</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-underlined-on</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">hyperlink-clicked-style</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">([</span><span class="n">delta</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-delta-background</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">color%</span><span class="w"> </span><span class="mi">68</span><span class="w"> </span><span class="mi">119</span><span class="w"> </span><span class="mi">170</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">set-underlined-on</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">delta</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Next, we need a function to actually insert the hyperlink text. <code>insert-hyperlink</code> will first insert the <code>items</code> as markdown items by extending the <code>style-list</code> with the <code>hyperlink-style</code> (thus the hyperlink color and underline is added to the style that is already present).</p>

<p>To actually create a link that can be clicked on, the function will use <code>set-clickback</code> method of the <code>text%</code> class to install a callback for when the text is clicked, the function will invoke a callback which can be used for anything &mdash; in particular, it could be used to open links inside the application itself, not just for web browsing. Since this is a simple application, we&rsquo;ll just print out the link target when it is clicked:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-hyperlink</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">((</span><span class="n">start</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">hyperlink-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">set-clickback</span><span class="w"></span>
<span class="w">          </span><span class="n">start</span><span class="w"> </span><span class="n">end</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" style="color: inherit">lambda</a></span><span class="w"> </span><span class="p">(</span><span class="n">editor</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._printf))" style="color: inherit">printf</a></span><span class="w"> </span><span class="s2">"Would follow URL: ~a~%"</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="c1">;;(send-url target)</span><span class="w"></span>
<span class="w">            </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">hyperlink-clicked-style</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>Finally, we can extend the <code>insert-md-item</code> function to recognize the <code>a</code> tags and add call <code>insert-hyperlink</code> for them:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="c1">;; Handling other element types is unchanged</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/dicts.html#(def._((lib._racket/dict..rkt)._dict-ref))" style="color: inherit">dict-ref</a></span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="o">'</span><span class="ss">href</span><span class="w"> </span><span class="no">#f</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-hyperlink</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" style="color: inherit">car</a></span><span class="w"> </span><span class="n">target</span><span class="p">))))</span><span class="w"></span>
<span class="w">          </span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>So, we can how insert interactive links in the text editor using the markdown link syntax:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"This is a [link](https://example.com)"</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md5.gif" alt="" />
 <p class="caption"></p></div>

<h3 id="images">Images</h3>

<p>Markdown also has support for in-line images, and so does the text editor, so we can add support for them too. <code>parse-markdown</code> will parse an image as follows:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">parse-markdown</span><span class="w"> </span><span class="s2">"![](/path/to/image.png)"</span><span class="p">)</span><span class="w"></span>
<span class="o">'</span><span class="p">((</span><span class="ss">div</span><span class="w"></span>
<span class="w">   </span><span class="p">((</span><span class="ss"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="s2">"figure"</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">img</span><span class="w"> </span><span class="p">((</span><span class="ss">src</span><span class="w"> </span><span class="s2">"/path/to/image.png"</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="ss">alt</span><span class="w"> </span><span class="s2">""</span><span class="p">)))</span><span class="w"></span>
<span class="w">   </span><span class="p">(</span><span class="ss">p</span><span class="w"> </span><span class="p">((</span><span class="ss"><a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._class))" style="color: inherit">class</a></span><span class="w"> </span><span class="s2">"caption"</span><span class="p">)))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The entire image is enclosed in a <code>div</code> block, but we can handle that just as a normal paragraph (<code>p</code> block). The actual image is in the <code>img</code> block and the path to the image is the <code>src</code> attribute of this block.</p>

<p>Here is the function which inserts an image into the editor (images are stored in <code>image-snip%</code> objects). The image is set up in a separate paragraph, and to make it appear centered in the editor, we set the paragraph alignment for the image paragraph to <code>'centered</code>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-image</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">image-path</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">snip</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">image-snip%</span><span class="w"> </span><span class="n">image-path</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="n">snip</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">paragraph</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-paragraph</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">set-paragraph-alignment</span><span class="w"> </span><span class="n">paragraph</span><span class="w"> </span><span class="o">'</span><span class="ss">center</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And we update the <code>insert-md-item</code> to recognize both <code>div</code> blocks and <code>img</code> blocks, calling <code>insert-image</code> for the <code>img</code> block:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">p</span><span class="w"> </span><span class="n">div</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="no">#t</span><span class="p">))</span><span class="w"></span>
<span class="w">          </span><span class="c1">;; Other block types are handled as before</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">img</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/dicts.html#(def._((lib._racket/dict..rkt)._dict-ref))" style="color: inherit">dict-ref</a></span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="o">'</span><span class="ss">src</span><span class="w"> </span><span class="no">#f</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-image</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" style="color: inherit">car</a></span><span class="w"> </span><span class="n">image</span><span class="p">))))</span><span class="w"></span>
<span class="w">          </span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>We can now insert images in the text editor using the following syntax:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"This is the Racket Logo:</span>
<span class="s2">![](./racket-logo.png)</span>
<span class="s2"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> the racket website is at [www.racket-lang.org](https://www.racket-lang.org)"</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md6.png" alt="" />
 <p class="caption"></p></div>

<h3 id="blockquotes">Blockquotes</h3>

<p>Inserting images showed that, not only we can apply styling to text, but we can also manipulate paragraphs &mdash; this functionality will be needed for supporting block quotes. Markdown supports quoting text by prefixing lines with the "&gt;" character and block quotes can be nested.</p>

<p>The Markdown parser created <code>blockquote</code> blocks for text inside the block-quotes, and these can be nested as well. We will display these using slightly slanted text and they will be indented relative to their parent paragraph:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">parse-markdown</span><span class="w"> </span><span class="s2">"&gt; <a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a> is a quote"</span><span class="p">)</span><span class="w"></span>
<span class="o">'</span><span class="p">((</span><span class="ss">blockquote</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="ss">p</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="s2">"this is a quote"</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The &ldquo;slanted&rdquo; style can be created by using a style delta:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">bq-style</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" style="color: inherit">make-object</a></span><span class="w"> </span><span class="n">style-delta%</span><span class="w"> </span><span class="o">'</span><span class="ss">change-style</span><span class="w"> </span><span class="o">'</span><span class="ss">slant</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>For the indentation of the paragraph, we need to keep track of the nesting level, and we can do that using a parameter:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">paragraph-indent</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(def._((quote._~23~25kernel)._make-parameter))" style="color: inherit">make-parameter</a></span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The paragraph indent is increased inside <code>insert-md-item</code>, where the <code>blockquote</code> is handled: the indent is increased by 20 pixels for each level, and the items in the blockquote are inserted using the additional <code>blockquote-style</code>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="c1">;; Other block handling remains unchanged</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">blockquote</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" style="color: inherit">parameterize</a></span><span class="w"> </span><span class="p">([</span><span class="n">paragraph-indent</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" style="color: inherit">+</a></span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">(</span><span class="n">paragraph-indent</span><span class="p">))])</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">bq-style</span><span class="w"> </span><span class="n">style-list</span><span class="p">))</span><span class="w"> </span><span class="no">#t</span><span class="p">))))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>To actually indent the paragraph, the <code>insert-md-items</code> function now looks at the <code>paragraph-indent</code> parameter, and will modify the paragraph margins as each paragraph is inserted:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="p">(</span><span class="n">paragraph?</span><span class="w"> </span><span class="no">#f</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="n">paragraph?</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" style="color: inherit">not</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" style="color: inherit">zero?</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-position</span><span class="p">))))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">paragraph</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">last-paragraph</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for))" style="color: inherit">for</a></span><span class="w"> </span><span class="p">([</span><span class="n">item</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" style="color: inherit">in-list</a></span><span class="w"> </span><span class="n">items</span><span class="p">)])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-md-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span><span class="w"> </span><span class="n">paragraph?</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a></span><span class="w"> </span><span class="p">(</span><span class="n">paragraph-indent</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">set-paragraph-margins</span><span class="w"> </span><span class="n">paragraph</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">paragraph-indent</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">paragraph-indent</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">paragraph-indent</span><span class="p">))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>And that&rsquo;s all there is to it:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"Here is a block quote:</span>

<span class="s2"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3e))" style="color: inherit">&gt;</a> <a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a> the block quote, <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> below we have a nested <a href="http://docs.racket-lang.org/reference/quote.html#(form._((quote._~23~25kernel)._quote))" style="color: inherit">quote</a></span>

<span class="s2">&gt;&gt; <a href="http://docs.racket-lang.org/reference/createclass.html#(form._((lib._racket/private/class-internal..rkt)._this))" style="color: inherit">this</a> is a nested <a href="http://docs.racket-lang.org/reference/quote.html#(form._((quote._~23~25kernel)._quote))" style="color: inherit">quote</a></span>

<span class="s2">This text is back at toplevel"</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md7.png" alt="" />
 <p class="caption"></p></div>

<h3 id="ordered-and-unordered-lists">Ordered and Unordered Lists</h3>

<p>The last feature we&rsquo;ll look at are lists, both the &ldquo;ordered&rdquo; or numbered and unordered kind. These will be handled by prefixing each item with an incrementing number for ordered lists and with a bullet for unordered ones. To keep things simple for a blog post, the numbering scheme and bullet types will not change as the nesting level changes, but this could also be implemented relatively easily.</p>

<p>The markdown parser produces <code>ol</code> and <code>ul</code> blocks for ordered and unordered lists, respectively, and a <code>li</code> block for each list item (a <code>li</code> block is used regardless whether the list is ordered or not. Also, the markdown parser does not keep track of the list item number, we must do that ourselves.</p>

<p>First, we&rsquo;ll need to keep track of the list nesting level and the number of the current list item, for unordered lists <code>list-item</code> will be <code>#f</code>:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">list-nesting</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(def._((quote._~23~25kernel)._make-parameter))" style="color: inherit">make-parameter</a></span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">list-item</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>The <code>insert-list-item</code> function is used to insert a list item in a <code>li</code> block, and handles both unordered and ordered lists: it sets the <code>paragraph-indent</code> corresponding to the nesting level and adds a new item to be inserted, either a number for ordered lists or a bullet for unordered ones:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-list-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" style="color: inherit">parameterize</a></span><span class="w"> </span><span class="p">([</span><span class="n">paragraph-indent</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">(</span><span class="n">list-nesting</span><span class="p">))])</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="n">marker</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="n">list-item</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin0))" style="color: inherit">begin0</a></span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" style="color: inherit">format</a></span><span class="w"> </span><span class="s2">"~a.    "</span><span class="w"> </span><span class="n">list-item</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">list-item</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" style="color: inherit">add1</a></span><span class="w"> </span><span class="n">list-item</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="s2">"•   "</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="n">insert-md-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._cons))" style="color: inherit">cons</a></span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="n">style-list</span><span class="w"> </span><span class="no">#t</span><span class="p">)))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p><code>insert-md-items</code> is updated to handle the <code>ul</code>, <code>ol</code> and <code>li</code> blocks as well. To make it look nicer, the code for both ordered and unordered lists</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span><span class="w"> </span><span class="p">(</span><span class="n">insert-markdown-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" style="color: inherit">string?</a></span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">insert-and-apply-styles</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">style-list</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-let))" style="color: inherit">match-let</a></span><span class="w"> </span><span class="p">([(</span><span class="n">list-rest</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">item</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" style="color: inherit">case</a></span><span class="w"> </span><span class="n">name</span><span class="w"></span>
<span class="w">          </span><span class="c1">;; Other block handling remains unchanged</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">ul</span><span class="w"> </span><span class="n">ol</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" style="color: inherit">zero?</a></span><span class="w"> </span><span class="p">(</span><span class="n">list-nesting</span><span class="p">))</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" style="color: inherit">let</a></span><span class="w"> </span><span class="p">((</span><span class="n">old-list-item</span><span class="w"> </span><span class="n">list-item</span><span class="p">))</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">list-item</span><span class="w"> </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Equality.html#(def._((quote._~23~25kernel)._equal~3f))" style="color: inherit">equal?</a></span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">'</span><span class="ss">ol</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="no">#f</span><span class="p">))</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" style="color: inherit">parameterize</a></span><span class="w"> </span><span class="p">([</span><span class="n">list-nesting</span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._add1))" style="color: inherit">add1</a></span><span class="w"> </span><span class="p">(</span><span class="n">list-nesting</span><span class="p">))])</span><span class="w"></span>
<span class="w">               </span><span class="p">(</span><span class="n">insert-markdown-items</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="p">))</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" style="color: inherit">set!</a></span><span class="w"> </span><span class="n">list-item</span><span class="w"> </span><span class="n">old-list-item</span><span class="p">))</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span><span class="w"> </span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._zero~3f))" style="color: inherit">zero?</a></span><span class="w"> </span><span class="p">(</span><span class="n">list-nesting</span><span class="p">))</span><span class="w"></span>
<span class="w">             </span><span class="p">(</span><span class="n">insert-newline</span><span class="w"> </span><span class="n">editor</span><span class="p">)))</span><span class="w"></span>
<span class="w">          </span><span class="p">((</span><span class="n">li</span><span class="p">)</span><span class="w"></span>
<span class="w">           </span><span class="p">(</span><span class="n">insert-list-item</span><span class="w"> </span><span class="n">editor</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="n">style-list</span><span class="p">))))))</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<p>So we are able to handle nested lists as well, with only a small amount of additional Racket code:</p>

<div class="brush: racket">
 <div class="source">
  <table class="sourcetable">
   <tbody>
    <tr>
     <td class="linenos">
      <div class="linenodiv">
       <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td>
     <td class="code">
      <div>
       <pre><span></span><span class="p">(</span><span class="n">insert-markdown</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="s2">"Ordered <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a> unordered <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" style="color: inherit">list</a> demo</span>

<span class="s2">1. <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._first))" style="color: inherit">first</a> item</span>
<span class="s2">1. <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._second))" style="color: inherit">second</a> item</span>
<span class="s2">    <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a> <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._first))" style="color: inherit">first</a> sub item</span>
<span class="s2">         1. <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._first))" style="color: inherit">first</a> sub-sub item</span>
<span class="s2">         1. <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._second))" style="color: inherit">second</a> sub-sub item</span>
<span class="s2">    <a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a> <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._second))" style="color: inherit">second</a> sub item</span>
<span class="s2">1. <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._third))" style="color: inherit">third</a> item</span>
<span class="s2">"</span><span class="p">)</span><span class="w"></span>
</pre></div></td></tr></tbody></table></div>

</div>

<div class="figure"><img src="/img/a039/md8.png" alt="" />
 <p class="caption"></p></div>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>There are a few more element types available in Markdown which would need to be handled to make this a complete application, however, the techniques presented here apply to those elements as well.</p>

<p>Being a visual application, we need to make some decisions on how to represent the markup on screen, and this is currently hard coded, although the style deltas used can be created from a styling description language. Some other parameters are also hard coded, such as how much a paragraph is indented, but these too can be made configurable.</p>

<p>As presented here, the program is just under 200 lines of Racket code, and hopefully it is easy to understand. It need some more polishing for a complete application, but it can be useful even as is, if you want to play with the code, it is available in <a href="https://gist.github.com/alex-hhh/51ad508797cd49fde90359fd4a3d7a89">this GitHub Gist</a>.</p>
  <footer>
    <div class="fine-print">© Alex Harsányi, licensed under
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      , and there's a <a href="/Cookies.html">cookie policy</a>.
    </div>
    <div class="row justify-content-center">
      <nav aria-label="Page Navigation">
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="/2020/05/dependency-management-in-racket-applications.html"
               aria-label="Previous">
              <span aria-hidden="true">&larr; Dependency Management in Racket Applications</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="/2020/06/ishido.html"
               aria-label="Next">
              <span aria-hidden="true">Ishido &rarr;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </footer>
</article>
        </div>
        <div id="sidebar-content" class="col-md-3">
          <!-- will be filled in dynamically by custom.js -->
        </div>

      </div>

    </div>
  </body>
</html>