<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Interactive Overlays With the Racket Plot Package</title>
    <meta name="description" content="The Racket plot package produces interactive `snip%` objects which allow zooming of the plot area. While this is a cool and sometimes useful feature, the functionality is hard coded in the `plot-snip%` class inside the package. I extended the package to a...">
    <meta name="author"      content="Alex Harsányi">
    <meta name="keywords"    content="racket, data visualization">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
    <link rel="canonical" href="https://alex-hhh.github.io/2018/02/interactive-overlays-with-the-racket-plot-package.html">
    <link rel="next" href="/2018/01/changing-built-in-racket-packages.html">
    <link rel="prev" href="/2018/03/arduino-inclinometer-improvements.html">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono&display=swap" rel="stylesheet">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-110325732-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container">
        <a href="/index.html" class="navbar-brand">Alex Harsányi</a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbar_collapse" aria-controls="navbar_collapse"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav mr-auto">

            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu" role="menu" id="tags-menu-content">
                <!-- will be filled in dynamically by custom.js -->
              </ul>
            </li>
            <li>
              <a class="nav-link" href="/About.html">About</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/arduino.html">Arduino</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/racket.html">Racket</a>
            </li> 
            <li>
              <a class="nav-link" href="/tags/activitylog2.html">ActivityLog2</a>
            </li> 
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="row">

        <!-- Main column -->
        <!-- NOTE: there is a bug in the web server template renderer which
             indents all items inside if blocks.  This means that we cannot
             put the contents inside an if block, as all the <pre> tags will
             be indented.
          -->
        <div id="content" class=col-md-9>





          <article>
  <header>
    <h1>Interactive Overlays With the Racket Plot Package</h1>
    <p class='date-and-tags'>
<time datetime="2018-02-03" pubdate="true">2018-02-03</time> :: <span class="tags"><a href="/tags/racket.html">racket</a>, <a href="/tags/data-visualization.html">data visualization</a></span></p>
  </header>

<p>The <a href="http://docs.racket-lang.org/plot/index.html">Racket plot package</a> produces interactive <code>snip%</code> objects which allow zooming of the plot area. While this is a cool and sometimes useful feature, the functionality is hard coded in the <code>plot-snip%</code> class inside the package. I extended the package to allow the user to customize the interactive features of the plot, to display additional information when the user hovers the mouse over the plot.</p>
<!-- more-->

<hr />

<p><strong>Update 20 Mar 2018</strong> There is an updated <a href="/2018/03/interactive-overlays-with-the-racket-plot-package-update.html">blog post</a> detailing the actual code that made it into the official racket plot package. The overall functionality and capabilities remain the same but the API is different.</p>

<hr />

<h2 id="a-simple-example">A simple example</h2>

<p>Here is a simple example that replaces the default zoom behavior of the plots with code that displays the current value of the function at the mouse location:</p>

<div class="figure"><img src="/img/a010/plot-hover-5.gif" alt="" />
 <p class="caption"></p></div>

<hr />

<p><strong>NOTE:</strong> The above plot was generated by running inside DrRacket the source code shown below. The program depends on a special build of the plot library which you can find <a href="https://github.com/alex-hhh/plot/tree/ah/interactive-overlays">here</a>, note that the code is on the &ldquo;ah/interactive-overlays&rdquo; branch. You will need to install this as a local package. If you don&rsquo;t know how to do that, <a href="/2018/01/changing-built-in-racket-packages.html">this post</a> may help.</p>

<hr />

<p>The program works by first creating a plot object using the <code>plot-snip</code> function. Next, the callback <code>on-hover</code> is added to the resulting plot snip object using <code>set-mouse-callback</code>. This callback is invoked each time the mouse moves over the plot and the X and Y coordinates passed to the callback are in the plot domain, in the example above, X will be between &ndash;10 and 10, as this was specified to the plot function, and Y will be between &ndash;1 and 1 which is the range of the sine function. The callback itself can add any number of overlays to the plot and they will be shown. In this example, it adds a vertical line, a marker at the function value at the mouse location and a label where the mouse cursor is.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="kn">#lang </span><span class="nn">racket</span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" style="color: inherit">require</a></span> <span class="n">plot</span> <span class="n">pict</span><span class="p">)</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="p">(</span><span class="n">add-pict-overlay</span> <span class="n">plot-snip</span> <span class="n">x</span> <span class="n">y</span> <span class="n">pict</span><span class="p">)</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">plot-snip</span> <span class="n">add-general-overlay</span> <span class="n">x</span> <span class="n">y</span>
        <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" style="color: inherit">lambda</a></span> <span class="p">(</span><span class="n">dc</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="n">draw-pict</span> <span class="n">pict</span> <span class="n">dc</span> <span class="n">x</span> <span class="n">y</span><span class="p">))</span>
        <span class="p">(</span><span class="n">pict-width</span> <span class="n">pict</span><span class="p">)</span>
        <span class="p">(</span><span class="n">pict-height</span> <span class="n">pict</span><span class="p">)))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="p">(</span><span class="n">on-hover</span> <span class="n">snip</span> <span class="n">event</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">clear-overlays</span><span class="p">)</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" style="color: inherit">when</a></span> <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" style="color: inherit">and</a></span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="n">sx</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))" style="color: inherit">sin</a></span> <span class="n">x</span><span class="p">))</span>
    <span class="c1">;; Add vertical line at current position</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-vrule-overlay</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1">;; Mark the value on the plot at the current position</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-mark-overlay</span> <span class="n">x</span> <span class="n">sx</span> <span class="kd">#:radius</span> <span class="mi">10</span> <span class="kd">#:label</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))" style="color: inherit">~r</a></span> <span class="n">sx</span> <span class="kd">#:precision</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1">;; Add a picture at the current mouse location</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="n">p</span> <span class="p">(</span><span class="n">vl-append</span> <span class="p">(</span><span class="n">text</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" style="color: inherit">format</a></span> <span class="s2">"X Value ~a"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))" style="color: inherit">~r</a></span> <span class="n">x</span> <span class="kd">#:precision</span> <span class="mi">2</span><span class="p">)))</span>
                         <span class="p">(</span><span class="n">text</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" style="color: inherit">format</a></span> <span class="s2">"Y Value ~a"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7er))" style="color: inherit">~r</a></span> <span class="n">sx</span> <span class="kd">#:precision</span> <span class="mi">2</span><span class="p">)))))</span>
    <span class="p">(</span><span class="n">add-pict-overlay</span> <span class="n">snip</span> <span class="n">x</span> <span class="n">y</span> <span class="n">p</span><span class="p">))</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">refresh-overlays</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="n">snip</span> <span class="p">(</span><span class="n">plot-snip</span> <span class="p">(</span><span class="n">function</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sin))" style="color: inherit">sin</a></span><span class="p">)</span>
                        <span class="kd">#:x-min</span> <span class="mi">-10</span> <span class="kd">#:x-max</span> <span class="mi">10</span> 
                        <span class="kd">#:width</span> <span class="mi">400</span> <span class="kd">#:height</span> <span class="mi">250</span><span class="p">))</span>
<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">set-mouse-callback</span> <span class="n">on-hover</span><span class="p">)</span>
<span class="n">snip</span> <span class="c1">; show the snip in the REPL.</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h2 id="vertical-rule-and-function-value">Vertical rule and function value</h2>

<p>The image below shows the application of this basic idea to an actual use case: to show the current value of the data at the mouse location. This example is a bit more complex, as there are two linked plots and when the mouse hovers over one of them, the current value at that position is shown on both of them &mdash; this mechanism can be extended to any number of plots.</p>

<div class="figure"><img src="/img/a010/plot-hover-1.gif" alt="" />
 <p class="caption"></p></div>

<p>This example is from the <a href="/2017/09/introducing-activitylog2.html">ActivityLog2</a> application. This is implemented in the <code>draw-marker-at</code> method in the <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/inspect-graphs.rkt#L627">rkt/inspect-graphs.rkt</a> file.</p>

<h2 id="highlight-regions">Highlight regions</h2>

<p>Another use case is to highlight a region on the plot. In the image below, the current lap of an activity is highlighted when the user selects a lap on the left. This functionality could also be achieved using the <code>lines-interval</code> plot renderer, but this requires redrawing the entire render tree each time a new lap is highlighted. Since a usual bike ride contains between 5000 and 10000 data points rendering it takes some time and the lap highlight would introduce unpleasant delays.</p>

<div class="figure"><img src="/img/a010/plot-hover-2.gif" alt="" />
 <p class="caption"></p></div>

<p>This is implemented in the <code>highlight-interval</code> method in the <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/inspect-graphs.rkt#L752">rkt/inspect-graphs.rkt</a> file.</p>

<h2 id="display-complex-information">Display complex information</h2>

<p>Sometimes a plot is based on complex underlying information and displaying it is really useful. The data for the power-duration plot shown below is constructed as follows:</p>

<ul>
 <li>for each bike session, the mean maximal values are determined for a set of  predefined durations&mdash; that is, the best power maintained over 10s, 15s,  1min, etc, over the entire ride.</li>
 <li>for each duration, the best power for that duration is selected from the  list of sessions</li>
 <li>spline interpolation is used to plot these power values as a function of  duration (the purple line on the plot)</li>
 <li>a theoretical power-duration model is fitted over this data</li></ul>

<p>This is a lot of information, which ultimately is represented as two curves on a plot. Using interactive overlays, the underlying data can be explored: the maximal power and modeled maximal power at the current duration, and the two original data points from which the interpolation is done, including the date when the bike sessions occurred.</p>

<div class="figure"><img src="/img/a010/plot-hover-3.gif" alt="" />
 <p class="caption"></p></div>

<p>This is implemented in the <code>plot-hover-callback</code> in the <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/trends-bavg.rkt#L575">rkt/trends-bavg.rkt</a> file.</p>

<h2 id="displaying-information-on-histogram-plots">Displaying information on histogram plots</h2>

<p>Histogram plots benefit from displaying additional information about the bar under the cursor. In the example below, the underlying cummulative times that form the basis for the histogram bars are displayed when the mouse is moved over the relevant section.</p>

<div class="figure"><img src="/img/a010/plot-hover-4.gif" alt="" />
 <p class="caption"></p></div>

<p>Histogram plots pose a special challenge as the plot X domain does not directly represent the histogram slots. To convert an X plot coordinate back into the histogram slot, the following information is used:</p>

<ul>
 <li>The X domain is the real axis, starting at 0 by default</li>
 <li>The distance between each histogram bar is specified by the  <code>discrete-histogram-skip</code> parameter or the <code>#:skip</code> argument to the  <code>discrete-histogram</code> renderer</li>
 <li>The width of each histogram bar is one minus <code>discrete-histogram-gap</code>, or  the <code>#:gap</code> parameter passed to the renderer.</li>
 <li>Multiple histograms can be shown, each having a different starting point, as  specified by the <code>#:x-min</code> parameter</li></ul>

<p>The function below converts an X position back to the histogram series and the slot within that series:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="p">(</span><span class="n">xposition-&gt;histogram-slot</span> <span class="n">xposition</span>
                                   <span class="p">(</span><span class="n">skip</span> <span class="p">(</span><span class="n">discrete-histogram-skip</span><span class="p">))</span>
                                   <span class="p">(</span><span class="n">gap</span> <span class="p">(</span><span class="n">discrete-histogram-gap</span><span class="p">)))</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" style="color: inherit">let*</a></span> <span class="p">((</span><span class="n">slot</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._exact-floor))" style="color: inherit">exact-floor</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span> <span class="n">xposition</span> <span class="n">skip</span><span class="p">)))</span>
         <span class="p">(</span><span class="n">offset</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span> <span class="n">xposition</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" style="color: inherit">*</a></span> <span class="n">skip</span> <span class="n">slot</span><span class="p">)))</span>
         <span class="p">(</span><span class="n">series</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((lib._racket/math..rkt)._exact-floor))" style="color: inherit">exact-floor</a></span> <span class="n">offset</span><span class="p">))</span>
         <span class="p">(</span><span class="n">on-bar?</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._~3c))" style="color: inherit">&lt;</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span> <span class="n">gap</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span> <span class="n">offset</span> <span class="n">series</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" style="color: inherit">-</a></span> <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" style="color: inherit">/</a></span> <span class="n">gap</span> <span class="mi">2</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" style="color: inherit">if</a></span> <span class="n">on-bar?</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" style="color: inherit">values</a></span> <span class="n">series</span> <span class="n">slot</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" style="color: inherit">values</a></span> <span class="no">#f</span> <span class="no">#f</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>The example in the image above is implemented in the <code>plot-hover-callback</code> method in the <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/trends-trivol.rkt#L280">rkt/trends-trivol.rkt</a> file. There are other examples of adding overlays to histogram plots in the <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/inspect-histogram.rkt#L268">rkt/inspect-histogram.rkt</a>, <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/trends-trivol.rkt#L280">rkt/trends-hist.rkt</a>, <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/trends-tiz.rkt#L290">rkt/trends-tiz.rkt</a> and <a href="https://github.com/alex-hhh/ActivityLog2/blob/master/rkt/trends-vol.rkt#L251">rkt/trends-vol.rkt</a> files.</p>

<h2 id="summary-of-the-new-plot-snip-methods">Summary of the new <code>plot-snip%</code> methods</h2>

<p>The following methods were added to the <code>snip%</code> object returned by <code>plot-snip%</code>:</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">set-mouse-callback</span> <span class="n">callback</span><span class="p">)</span>
<span class="n">callback:</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" style="color: inherit">or/c</a></span> <span class="no">#f</span> <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" style="color: inherit">-&gt;</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#(def._((lib._racket/class..rkt)._is-a~3f/c))" style="color: inherit">is-a?/c</a></span> <span class="n">2d-plot-snip%</span><span class="p">)</span> 
                       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#(def._((lib._racket/class..rkt)._is-a~3f/c))" style="color: inherit">is-a?/c</a></span> <span class="n">mouse-event%</span><span class="p">)</span>
                       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" style="color: inherit">or/c</a></span> <span class="no">#f</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" style="color: inherit">number?</a></span><span class="p">)</span> 
                       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" style="color: inherit">or/c</a></span> <span class="no">#f</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" style="color: inherit">number?</a></span><span class="p">)</span> 
                       <span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" style="color: inherit">any/c</a></span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">clear-overlays</span><span class="p">)</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">refresh-overlays</span><span class="p">)</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-mark-overlay</span>
    <span class="n">x</span> <span class="n">y</span>
    <span class="kd">#:radius</span> <span class="p">(</span><span class="n">r</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">#:pen</span> <span class="p">(</span><span class="n">pen</span> <span class="no">#f</span><span class="p">)</span>
    <span class="kd">#:brush</span> <span class="p">(</span><span class="n">brush</span> <span class="no">#f</span><span class="p">)</span>
    <span class="kd">#:label</span> <span class="p">(</span><span class="n">label</span> <span class="no">#f</span><span class="p">)</span>
    <span class="kd">#:label-offset</span> <span class="p">(</span><span class="n">offset</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">#:label-font</span> <span class="p">(</span><span class="n">font</span> <span class="no">#f</span><span class="p">)</span>
    <span class="kd">#:label-fg-color</span> <span class="p">(</span><span class="n">fg-color</span> <span class="no">#f</span><span class="p">)</span>
    <span class="kd">#:label-bg-color</span> <span class="p">(</span><span class="n">bg-color</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-vrule-overlay</span> <span class="n">x</span> <span class="kd">#:pen</span> <span class="p">(</span><span class="n">pen</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-hrule-overlay</span> <span class="n">y</span> <span class="kd">#:pen</span> <span class="p">(</span><span class="n">pen</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-xrule-overlay</span> <span class="n">x</span> <span class="n">y</span> <span class="kd">#:pen</span> <span class="p">(</span><span class="n">pen</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-vrange-overlay</span> <span class="n">xmin</span> <span class="n">xmax</span> <span class="kd">#:brush</span> <span class="p">(</span><span class="n">brush</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-hrange-overlay</span> <span class="n">ymin</span> <span class="n">ymax</span> <span class="kd">#:brush</span> <span class="p">(</span><span class="n">brush</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-rect-overlay</span> <span class="n">xmin</span> <span class="n">xmax</span> <span class="n">ymin</span> <span class="n">ymax</span> <span class="kd">#:brush</span> <span class="p">(</span><span class="n">brush</span> <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">snip</span> <span class="n">add-general-overlay</span> <span class="n">x</span> <span class="n">y</span> <span class="n">draw-fn</span> <span class="n">width</span> <span class="n">height</span> <span class="kd">#:offset</span> <span class="p">(</span><span class="n">offset</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">draw-fn:</span> <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" style="color: inherit">-&gt;</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#(def._((lib._racket/class..rkt)._is-a~3f/c))" style="color: inherit">is-a?/c</a></span> <span class="n">dc%</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" style="color: inherit">number?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" style="color: inherit">number?</a></span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p><code>set-mouse-callback</code> arranges for CALLBACK to be invoked when the mouse hovers over the plot, or when #f is passed, disable the callback. When a hover callback is active, the default &ldquo;zoom on mouse drag&rdquo; behavior of the plot snip is disabled.</p>

<p>The callback is invoked with the snip, the mouse event and the X, Y coordinates where the mouse is. The X, Y coordinates are in plot coordinate system, the domain over which data is being plotted.</p>

<p>The CALLBACK will also be invoked with X and Y being #f when the mouse is over the plot snip, but outside the actual plot area.</p>

<p>The snip% object passed to the callback will always be the one that generated the event and it should be used to add any overlays. Plot snips can be copied (they certainly are when they are shown in DrRacket), and it is easy to receive hover events from a copy and adding overlays to the original.</p>

<hr />

<p><code>clear-overlays</code> will clear all overlays added to the snip. The overlays are only cleared when this method is called, so a callback that adds overlays as the mouse moves should start by clearing the previous overlays.</p>

<hr />

<p><code>refresh-overlays</code> will refresh the plot area and draw the overlays. Overlays are not drawn when they are added, so a callback that adds overlays should finish by refreshing the overlays. Originally, each of the <code>add-*-overlay</code> function contained an internal refresh, but this resulted in the plot being refreshed too many times: once after each overlay was added.</p>

<hr />

<p><code>add-mark-overlay</code> will add a marker overlay at position X Y on the plot (X and Y are in plot coordinates). The marker is a circle of RADIUS drawn with PEN and BRUSH, or if these parameters are #f a default pen and brush is used. If RADIUS is 0 or negative, the circle is not drawn, this can be used to draw the LABEL only.</p>

<p>LABEL, if not #f, is a string drawn next to the marker, it will be offset in X and Y axes by OFFSET pixels and will be drawn in one of the &ldquo;top-right&rdquo;, &ldquo;top-left&rdquo;, &ldquo;bottom-right&rdquo;, &ldquo;bottom-left&rdquo; positions such that the label is always inside the plot. For example, the label is drawn top-right of the marker by default, but if this would result in the label being drawn off screen on the right, it will be moved to &ldquo;top-left&rdquo; position.</p>

<p>FONT, FG-COLOR and BG-COLOR are the font, foreground, and background colors for the label. If they are #f, default values are used.</p>

<hr />

<p><code>add-vrule-overlay</code> adds a vertical line at position X (in plot coordinates) using PEN.</p>

<hr />

<p><code>add-hrule-overlay</code> adds a horizontal line at position Y (in plot coordinates) using PEN.</p>

<hr />

<p><code>add-xrule-overlay</code> adds both a vertical and horizontal lines to the plot such that they intersect at X, Y (in plot coordinates). The lines are drawn using PEN. This method is equivalent to adding a vertical line at X and a horizontal line at Y, but it is more efficient.</p>

<hr />

<p><code>add-vrange-overlay</code> adds a rectangle overlay between XMIN and XMAX, in plot cordinates, for the entire height of the plot.</p>

<hr />

<p><code>add-hrange-overlay</code> adds a rectangle overlay between YMIN and YMAX, in plot cordinates, for the entire width of the plot.</p>

<hr />

<p><code>add-rect-overlay</code> adds a rectangle overlay between the points XMIN, YMIN, XMAX, YMAX, in plot coordinates.</p>

<hr />

<p><code>add-general-overlay</code> will add an overlay that is drawn by a user specified function, DRAWN-FN, at X Y (in plot coordinates) adjusted by OFFSET (in pixels) to either &ldquo;top-right&rdquo;, &ldquo;top-left&rdquo;, &ldquo;bottom-right&rdquo;, &ldquo;bottom-left&rdquo;, such that the drawing area is visible on the plot. WIDTH and HEIGHT represent the dimensions of the picture that will be drawn by DRAWN-FN and they are used to determine the adjustment position relative to the X, Y coordinates.</p>

<p>The function will be invoked with a draw context and X, Y coordinates (in DC coordinates).</p>

<p>This method can be used to draw a pict at a specified position, by using a wrapper such as shown below. This was not included in the plot interface, to avoid a dependency of the plot package on the pict package.</p>

<div class="brush: racket">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre>1
2
3
4
5</pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" style="color: inherit">define</a></span> <span class="p">(</span><span class="n">add-pict-overlay</span> <span class="n">plot-snip</span> <span class="n">x</span> <span class="n">y</span> <span class="n">pict</span><span class="p">)</span>
  <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" style="color: inherit">send</a></span> <span class="n">plot-snip</span> <span class="n">add-general-overlay</span> <span class="n">x</span> <span class="n">y</span>
        <span class="p">(</span><span class="k"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" style="color: inherit">lambda</a></span> <span class="p">(</span><span class="n">dc</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="n">draw-pict</span> <span class="n">pict</span> <span class="n">dc</span> <span class="n">x</span> <span class="n">y</span><span class="p">))</span>
        <span class="p">(</span><span class="n">pict-width</span> <span class="n">pict</span><span class="p">)</span>
        <span class="p">(</span><span class="n">pict-height</span> <span class="n">pict</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table>
</div>

<h2 id="source-code">Source code</h2>

<p>You can find the code for the updated plot library <a href="https://github.com/alex-hhh/plot/tree/ah/interactive-overlays">here</a>, note that the code is on the &ldquo;ah/interactive-overlays&rdquo; branch. You will need to install this as a local package. If you don&rsquo;t know how to do that, <a href="/2018/01/changing-built-in-racket-packages.html">this post</a> may help.</p>

<p>There is also a <a href="https://github.com/racket/plot/pull/32">pull request</a> to get these changes back into the main plot library.</p>
  <footer>
    <div class="row justify-content-center">
      <nav aria-label="Page Navigation">
        <ul class="pagination">
          <li class="page-item">
            <a class="page-link" href="/2018/01/changing-built-in-racket-packages.html"
               aria-label="Previous">
              <span aria-hidden="true">&larr; Changing Built-in Racket Packages</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="/2018/03/arduino-inclinometer-improvements.html"
               aria-label="Next">
              <span aria-hidden="true">Arduino Inclinometer Improvements &rarr;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.identifier = undefined;
        this.page.url = undefined;
        this.page.title = undefined;
        this.page.category_id = undefined;
      };
      var disqus_shortname = 'alex-hhh-github-com';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          dsq.setAttribute('data-timestamp', +new Date());
          (document.head || document.body).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>
</article>
        </div>
        <div id="sidebar-content" class="col-md-3">
          <!-- will be filled in dynamically by custom.js -->
        </div>
      </div>
      <footer>
        <hr />
        <div class="fine-print">© Alex Harsányi, licensed under
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
          , and there's a <a href="/Cookies.html">cookie policy</a>.
        </div>
      </footer>
    </div>
    <!-- </body> JS -->
  <!-- NOTE: jQuery must be loaded first -->
  <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="/js/custom.js"></script>
  </body>
</html>